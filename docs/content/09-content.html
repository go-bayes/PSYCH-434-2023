<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2023-05-16">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023 - Causal inference: a step by step guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/index.html" rel="" target="">
 <span class="dropdown-text">Preliminaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html" rel="" target="">
 <span class="dropdown-text">1: Asking questions in cross-cultural psychology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html" rel="" target="">
 <span class="dropdown-text">2: Getting started with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html" rel="" target="">
 <span class="dropdown-text">3: Lost in Translation? Measurement and Language</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html" rel="" target="">
 <span class="dropdown-text">4: Dealing with Data (Factor Analysis)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/05-content.html" rel="" target="">
 <span class="dropdown-text">5: Dealing with Data (Multi-Group CFA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/06-content.html" rel="" target="">
 <span class="dropdown-text">6: Dealing with Data (Partial Invariance)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/07-content.html" rel="" target="">
 <span class="dropdown-text">7: Causal Inference: Causal Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/08-content.html" rel="" target="">
 <span class="dropdown-text">8: Causal Inference: Target Trial Emulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/09-content.html" rel="" target="">
 <span class="dropdown-text">9: Causal inference: Reconsidering measurement and selection biases</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/10-content.html" rel="" target="">
 <span class="dropdown-text">10: Causal Inference: Cross-Cultural Experiments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/11-content.html" rel="" target="">
 <span class="dropdown-text">11: Ethics and Ownership</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/12-content.html" rel="" target="">
 <span class="dropdown-text">12: Future Horizons</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal inference: a step by step guide</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 16, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#how-do-we-do-causal-estimation" id="toc-how-do-we-do-causal-estimation" class="nav-link" data-scroll-target="#how-do-we-do-causal-estimation">How do we do causal estimation?</a></li>
  <li><a href="#step-1-ask-a-causal-question" id="toc-step-1-ask-a-causal-question" class="nav-link" data-scroll-target="#step-1-ask-a-causal-question">STEP 1: ASK A CAUSAL QUESTION</a>
  <ul class="collapse">
  <li><a href="#a.-identify-the-outcomes-of-interest" id="toc-a.-identify-the-outcomes-of-interest" class="nav-link" data-scroll-target="#a.-identify-the-outcomes-of-interest">a. Identify the outcome(s) of interest</a></li>
  <li><a href="#b.-define-the-exposure-or-intervention" id="toc-b.-define-the-exposure-or-intervention" class="nav-link" data-scroll-target="#b.-define-the-exposure-or-intervention">b. Define the exposure or intervention</a></li>
  <li><a href="#c.-identify-pre-exposure-covariates-for-confounding-control" id="toc-c.-identify-pre-exposure-covariates-for-confounding-control" class="nav-link" data-scroll-target="#c.-identify-pre-exposure-covariates-for-confounding-control">c.&nbsp;Identify pre-exposure covariates for confounding control</a></li>
  <li><a href="#d.-highlight-unmeasured-pre-treatment-covariates" id="toc-d.-highlight-unmeasured-pre-treatment-covariates" class="nav-link" data-scroll-target="#d.-highlight-unmeasured-pre-treatment-covariates">d.&nbsp;Highlight unmeasured pre-treatment covariates</a></li>
  <li><a href="#e.-choose-the-scale-for-a-causal-contrast" id="toc-e.-choose-the-scale-for-a-causal-contrast" class="nav-link" data-scroll-target="#e.-choose-the-scale-for-a-causal-contrast">e. Choose the scale for a causal contrast</a></li>
  <li><a href="#summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" id="toc-summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" class="nav-link" data-scroll-target="#summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question">Summary Step 1: Consider how much we need to do when asking a causal question!</a></li>
  </ul></li>
  <li><a href="#step-2-answer-a-causal-question" id="toc-step-2-answer-a-causal-question" class="nav-link" data-scroll-target="#step-2-answer-a-causal-question">STEP 2: ANSWER A CAUSAL QUESTION</a>
  <ul class="collapse">
  <li><a href="#include-the-measured-exposure-with-baseline-covariates" id="toc-include-the-measured-exposure-with-baseline-covariates" class="nav-link" data-scroll-target="#include-the-measured-exposure-with-baseline-covariates">Include the measured exposure with baseline covariates</a></li>
  <li><a href="#state-the-eligibility-criteria-for-participation" id="toc-state-the-eligibility-criteria-for-participation" class="nav-link" data-scroll-target="#state-the-eligibility-criteria-for-participation">State the eligibility criteria for participation</a></li>
  <li><a href="#determine-how-missing-data-will-be-handled" id="toc-determine-how-missing-data-will-be-handled" class="nav-link" data-scroll-target="#determine-how-missing-data-will-be-handled">Determine how missing data will be handled</a></li>
  <li><a href="#state-a-statistical-model" id="toc-state-a-statistical-model" class="nav-link" data-scroll-target="#state-a-statistical-model">State a statistical model</a></li>
  <li><a href="#g-computation-for-subgroup-analysis-algorithm" id="toc-g-computation-for-subgroup-analysis-algorithm" class="nav-link" data-scroll-target="#g-computation-for-subgroup-analysis-algorithm"><strong>G-computation for Subgroup Analysis Algorithm</strong></a></li>
  <li><a href="#inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-algorithm" id="toc-inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-algorithm" class="nav-link" data-scroll-target="#inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-algorithm"><strong>Inverse Probability of Treatment Weighting (IPTW) for Subgroup Analysis Algorithm</strong></a></li>
  <li><a href="#doubly-robust-estimation-for-subgroup-analysis-algorithm" id="toc-doubly-robust-estimation-for-subgroup-analysis-algorithm" class="nav-link" data-scroll-target="#doubly-robust-estimation-for-subgroup-analysis-algorithm">Doubly Robust Estimation for Subgroup Analysis Algorithm</a></li>
  <li><a href="#provided-detailed-reporting-checklist-as-follows" id="toc-provided-detailed-reporting-checklist-as-follows" class="nav-link" data-scroll-target="#provided-detailed-reporting-checklist-as-follows">Provided Detailed Reporting: Checklist as follows</a></li>
  <li><a href="#desription-of-the-sample-characteristics" id="toc-desription-of-the-sample-characteristics" class="nav-link" data-scroll-target="#desription-of-the-sample-characteristics">Desription of the sample characteristics</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Recall that psychology begings with a question about cognition and behavior. What do we want to know? Before all else, we must ask, and motivate this question.</p>
<p>Suppose we have defined a question. How can we address it using observational data?</p>
<p>This is the topic of today’s seminar.</p>
</section>
<section id="how-do-we-do-causal-estimation" class="level2">
<h2 class="anchored" data-anchor-id="how-do-we-do-causal-estimation">How do we do causal estimation?</h2>
<p>There are two steps to causal estimation:</p>
<ol type="1">
<li>State a causal question</li>
<li>Answer that question [Cite Hernan]</li>
</ol>
</section>
<section id="step-1-ask-a-causal-question" class="level2">
<h2 class="anchored" data-anchor-id="step-1-ask-a-causal-question">STEP 1: ASK A CAUSAL QUESTION</h2>
<p>Stating a causal question requires describing: a. outcome(s), b. exposure, c.&nbsp;measured confounders, d.&nbsp;(suspected) unmeasured confounders, e. scale of causal contrasts, f.&nbsp;target population for whom the inferences apply.</p>
<p>We consider each of these processes in turn.</p>
<section id="a.-identify-the-outcomes-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="a.-identify-the-outcomes-of-interest">a. Identify the outcome(s) of interest</h3>
<p>We use <em>Y</em> to denote an outcome of interest. This is the “effect” of interest.</p>
<section id="consider" class="level4">
<h4 class="anchored" data-anchor-id="consider">Consider:</h4>
<ul>
<li>The outcome might be binary (severely distressed/not severely distressed), continuous (the average of the sum of the indicators), or a rate variable (the sum of the indicators).</li>
<li>It is crucial to specify the units in which the outcome is measured.</li>
<li>Transforming the outcome into standard deviation units can be beneficial.</li>
<li>The outcome must occur after the exposure or treatment.</li>
<li>We must designate a time period within which the outcome occurs, e.g, “the one-year effect of a treatment on well-being as measured by Kessler-6.”</li>
<li>We may be interested in multiple outcomes. This is the rational behind outcomewide science [cite tyler]</li>
<li>We must remember that the outcome might be measured with error, that such errors may be affected by the treatment or correlated with the measurement error of the treatment. (A topic of future seminars, which we will set to the side for now)</li>
</ul>
<p>Here, imagine we are interested in understanding only one outcome in our study: well-being as measured by the Kessler-6 depression/anxiety scale.</p>
</section>
</section>
<section id="b.-define-the-exposure-or-intervention" class="level3">
<h3 class="anchored" data-anchor-id="b.-define-the-exposure-or-intervention">b. Define the exposure or intervention</h3>
<p>We use <em>A</em> to denote the the exposure or treatment. This is the variable that we hypothesise might affect the outcome. This variable denotes the cause of interest. We will restrict our focus to consider in which there is only one treatment (i.e.&nbsp;we will not consider complex multi-treatment regimes.)</p>
<p>Here, imagine we are interested in understanding the causal effect of ‘Church attendance’.</p>
<section id="consider-1" class="level4">
<h4 class="anchored" data-anchor-id="consider-1">Consider:</h4>
<ul>
<li>To affect <em>Y</em>, <em>A</em> must occur before <em>Y</em>.</li>
<li>What does <em>A</em> indicate? We may characterise ‘Church Attendance’ as a binary exposure (attend/not attend) or as a continuous exposure (attend weekly/attend monthly). The exposure, in this instance, remains nebulous until we delineate the unit change in <em>A</em> we are interested in investigating.</li>
<li>For theoretical and practical purpose we might want to trunctate the variable into categories: (none/some; none/less than weekly, weekly or more)… Why? Because our causal question requires stating the contrast between the states of the world in which we are interested. Additionally, experts often make decisions on the basis of discrete thresholds (has risk of depression/does not).</li>
<li>We must remember that an exposure or treatment might be measured with error, that such errors might be correlated with the measurement error of the outcome or affect it. (Again, a topic of future seminars, which we will set to the side for now).</li>
<li>It must be conceptually possible to intervene within all stratums of baseline confounders (strong positivity).</li>
<li>It must be conceptually possible to understand an intervention on the exposure (consistency)</li>
<li>The multiple version of the intervention must exchangeable within levels of measured baseline confounders (consistency).</li>
</ul>
</section>
</section>
<section id="c.-identify-pre-exposure-covariates-for-confounding-control" class="level3">
<h3 class="anchored" data-anchor-id="c.-identify-pre-exposure-covariates-for-confounding-control">c.&nbsp;Identify pre-exposure covariates for confounding control</h3>
<p>We use <strong>L</strong> to denote the set of measured baseline confounders of the the exposure-outcome association. For a three-wave panel design, we employ VanderWeele’s modified disjunctive cause criterion, we advises: control for any covariate that is a cause of the exposure, the outcome, or both, excluding any instrumental variable and incorporating any proxy for an unmeasured variable that is a common cause of both the exposure and the outcome.</p>
<section id="consider-2" class="level4">
<h4 class="anchored" data-anchor-id="consider-2">Consider:</h4>
<ul>
<li>To affect <em>Y</em>, <em>L</em> must occur before <em>Y</em>.<br>
</li>
<li>To affect <em>A</em>, <em>L</em> must occur before <em>A</em>.</li>
<li>We must acheive balence within levels of the exposure such that <span class="math inline">A\coprod Y| L</span></li>
<li>Although we may gain precision by including an <em>L</em> that affects <em>Y</em> but is unrelated to <em>A</em>, including variables that occur after <em>A</em> will be hazardous if it is possible that <em>A</em> affects <em>L</em> (or its measurement).</li>
<li>A useful set of default counfounders in NZAVS studies is given in your workbooks.</li>
<li>Note we have left out the concept of “selection bias.” There are indeed sources of bias that may occure after <em>A</em>. This is another topic for the week ahead.</li>
</ul>
</section>
</section>
<section id="d.-highlight-unmeasured-pre-treatment-covariates" class="level3">
<h3 class="anchored" data-anchor-id="d.-highlight-unmeasured-pre-treatment-covariates">d.&nbsp;Highlight unmeasured pre-treatment covariates</h3>
<p>Let <strong>U</strong> denoted unmeasured pre-treatment covariates that may potentially bias the statistical association between <em>A</em> and <em>Y</em> independently of the measured covariates.</p>
<section id="consider-3" class="level4">
<h4 class="anchored" data-anchor-id="consider-3">Consider:</h4>
<ul>
<li>To affect <em>Y</em> and <em>A</em>, <em>U</em> must occur before <em>A</em>.</li>
<li>It is useful to draw a causal diagramme to illustrate all potential sources of bias.</li>
<li>Causal diagrammes are qualitative tools that require specialist expertise. We cannot typically obtain a causal graph from the data.</li>
<li>A causal diagramme should include only as much information as is required to assess confounding. See <a href="#fig-dag-outcomewide">Figure&nbsp;1</a> for an example.</li>
<li>Because we cannot ensure the absence of unmeasured confounders in observational settings, it is vital to conduct sensitivity analyses for the results. For sensitivity analyeses, we use E-values, a topic for a latter seminar.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-outcomewide" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-content_files/figure-html/fig-dag-outcomewide-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Causal graph: three-wave panel design.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="e.-choose-the-scale-for-a-causal-contrast" class="level3">
<h3 class="anchored" data-anchor-id="e.-choose-the-scale-for-a-causal-contrast">e. Choose the scale for a causal contrast</h3>
<p>Average causal effects can be inferred by contrasting the expected outcome when a population is exposed to an exposure level, <span class="math inline">E[Y(A = a)]</span>, with the expected outcome under a different exposure level, <span class="math inline">E[Y(A=a')]</span>.</p>
<p>For a binary treatment with levels <span class="math inline">A=0</span> and <span class="math inline">A=1</span>, the Average Treatment Effect (ATE), on the difference scale, is expressed:</p>
<p><span class="math display">ATE_{\text{risk difference}} = E[Y(1)|L] - E[Y(0)|L]</span></p>
<p>On the risk ratio scale, the ATE is expressed:</p>
<p><span class="math display">ATE_{\text{risk ratio}} = \frac{E[Y(1)|L]}{E[Y(0)|L]}</span></p>
<p>Other effect scales, such as the incidence rate ratio, incidence rate difference, or hazard ratio, might also be of interest. We can also define the Average Treatment Effect on the Treated (ATT) :</p>
<p><span class="math display">ATT_{\text{risk difference}} = E[Y(1) - Y(0)|A=1,L]</span></p>
<p><span class="math display">ATT_{\text{risk ratio}} = \frac{E[Y(1)|A=1,L]}{E[Y(0)|A=1, L]}</span></p>
<p>Another common estimand is the Population Average Treatment Effect (PATE), which denotes the effect the treatment would have on the entire population if applied universally to that population. This quantity can be expressed:</p>
<p><span class="math display">PATE_{\text{risk difference}} = f(E[Y(1) - Y(0)|L], W)</span></p>
<p><span class="math display">PATE_{\text{risk ratio}} = f\left(\frac{E[Y(1)|L]}{E[Y(0)|L]}, W\right)</span></p>
<p>where <span class="math inline">f</span> is a function that incorporates weights <span class="math inline">W</span> into the estimation of the expected outcomes. These weights may correspond to the inverse probability of being sampled or in the case of NZAVS data, the survey weights are given from census estimates for the wider population. Note: I will show you how to use weights in future seminars.</p>
<p>We might also be interested in identifying effects specific to certain strata, such as risk differences or risk ratios, as they are modified by baseline indicators. Denote a stratum of interest by <span class="math inline">G</span>. We may then compute:</p>
<p><span class="math display">ATE_{G,\text{risk difference}} = E[Y(1) - Y(0)|G, L]</span></p>
<p><span class="math display">ATE_{G,\text{risk ratio}} = \frac{E[Y(1)|G, L]}{E[Y(0)|G, L]}</span></p>
<section id="consider-4" class="level4">
<h4 class="anchored" data-anchor-id="consider-4">Consider:</h4>
<ul>
<li>** In this course, we are interested in stratum specific comparisons **</li>
<li>In the causal inference literature, the concept we use to make sense of stratum specific comparisons is called “effect modification.”</li>
<li>By inferring effects within stratums, we may evaluate whether the effects of different exposures or treatments on some well-defined outcome (measured in some well-defined time-period after the exposure) differ depending on group measurement.</li>
<li>The logic of effect modification differs from that of intereaction.</li>
</ul>
</section>
<section id="aside-extensions" class="level4">
<h4 class="anchored" data-anchor-id="aside-extensions">Aside: extensions</h4>
<p>For continuous exposures, we must stipulate the level of contrast for the exposure (e.g.&nbsp;weekly versus monthly church attendance):</p>
<p><span class="math display">ATE_{A,A'} = E[Y(A) - Y(A')| L]</span></p>
<p>This essentially denotes an average treatment effect comparing the outcome under treatment level <span class="math inline">A</span> to the outcome under treatment level <span class="math inline">A'</span>.</p>
<p>Likewise:</p>
<p><span class="math display">ATE_{A/A'} = \frac{E[Y(A)| L]}{E[Y(A')| L]}</span></p>
<p>This defines the contrast of <span class="math inline">A</span> and <span class="math inline">A'</span> on a ratio scale.</p>
</section>
<section id="f.-describe-the-populations-for-whom-the-intended-study-is-meant-to-generalise-by-distinguishing-between-source-and-target-populations." class="level4">
<h4 class="anchored" data-anchor-id="f.-describe-the-populations-for-whom-the-intended-study-is-meant-to-generalise-by-distinguishing-between-source-and-target-populations.">f.&nbsp;Describe the population(s) for whom the intended study is meant to generalise by distinguishing between source and target populations.</h4>
<p>Consider the following concepts:</p>
<ul>
<li><p><strong>Source population</strong>: A source population is where we gather our data for a study. We pull our specific sample from this group. It needs to mirror the broader group for our conclusions to be valid and widely applicable.</p></li>
<li><p><strong>Target population</strong>: The target population is the larger group we aim to apply our study’s results to. It could be defined by location, demographics, or specific conditions. The closer the source matches the target in ways that are relevant to our causal questions, the stronger our causal inferences about the target population will be.</p>
<ul>
<li><strong>Generalisability</strong> refers to the ability to apply the causal effects estimated from a sample to the population it was drawn from. In simpler terms, it deals with the extrapolation of causal knowledge from a sample to the broader population. This concept is also called “external validity”.</li>
</ul></li>
</ul>
<p><span class="math display">\text{Generalisability} = PATE \approx ATE_{\text{sample}}</span></p>
<ul>
<li><strong>Transportability</strong> refers to the ability to extrapolate causal effects learned from a source population to a target population when certain conditions are met. It deals with the transfer of causal knowledge across different settings or populations.</li>
</ul>
<p><span class="math display">\text{Transportability} = ATE_{\text{target}} \approx f(ATE_{\text{source}}, T)</span></p>
<p>where <span class="math inline">f</span> is a function and <span class="math inline">T</span> is a function that maps the results from our source population to another population. To achieve transportability, we need information about the source and target populations and an understanding of how the relationships between treatment, outcome, and covariates differ between the populations. Assessing transportability requires scientific knowledge.</p>
</section>
</section>
<section id="summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" class="level3">
<h3 class="anchored" data-anchor-id="summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question">Summary Step 1: Consider how much we need to do when asking a causal question!</h3>
<p>We discover that asking a causal question is a multifaceted task. It demands careful definition of the outcome, including its timing, the exposure, and covariates. It also requires selecting the appropriate scale for causal contrast, controlling for confounding, and potentially adjusting for sample weights or stratification. Finally, when asking a causal question, we must consider for whom the results apply. Only after following these steps can we then ask: “How may we answer this causal question?”</p>
</section>
</section>
<section id="step-2-answer-a-causal-question" class="level2">
<h2 class="anchored" data-anchor-id="step-2-answer-a-causal-question">STEP 2: ANSWER A CAUSAL QUESTION</h2>
<section id="obtain-longitudinal-data" class="level4">
<h4 class="anchored" data-anchor-id="obtain-longitudinal-data">Obtain longitudinal data</h4>
<p>Note that causal inference from observational data turns on the appropriate temporal ordering of the key variables involved in the study.</p>
<p>Recall we have defined.</p>
<ul>
<li><p><strong>A</strong>: Our exposure or treatment variable, denoted as <strong>A</strong>. Here we consider the example of ‘Church attendance’.</p></li>
<li><p><strong>Y</strong>: The outcome variable we are interested in, represented by <strong>Y</strong>, is psychological distress. We operationalise this variable through the ‘Kessler-6’ distress scale.</p></li>
<li><p><strong>L</strong>: The confounding variables, collectively referred to as <strong>L</strong>, represent factors that can independently influence both <strong>A</strong> and <strong>Y</strong>. For example, socio-economic status could be a confounder that impacts both the likelihood of church attendance and the levels of psychological distress.</p></li>
</ul>
<p>Given the importance of temporal ordering, we must now define time:</p>
<ul>
<li><strong>t <span class="math inline">\in</span> T</strong>: Let <span class="math inline">t</span> denote within a multiwave panel study with <strong>T</strong> measurement intervals.</li>
</ul>
<p>Where <span class="math inline">t/\text{{exposure}}</span> denotes the measurement interval for the exposure. Longitudinal data collection provides us the ability to establish a causal model such that:</p>
<p><span class="math display">t_{confounders} &lt; t_{exposure}&lt; t_{outcome}</span></p>
<p>To minimise the posibility of time-varying confounding and obtain the clearest effect estimates, we should acquire the most recent values of <span class="math inline">\mathbf{L}</span> preceding <span class="math inline">A</span> and the latest values of <span class="math inline">A</span> before <span class="math inline">Y</span>.</p>
<p>Note in <a href="#fig-dag-outcomewide">Figure&nbsp;1</a>, We use the prefixes “t0, t1, and t2” to denote temporal ordering. We include in the set of baseline confounders the pre-exposure measurement of <em>A</em> and <em>Y</em>. This allows for more substantial confounding control. For unmeasured confounder to affect both the exposure and the outcome, it would need to do so independently of the pre-exposure confounders. Additionally, including the baseline exposure gives us an effect estimate for the incidence exposure, rather than the prevelance of the exposure. This helps us to assess the expected change in the outcome were we to initate a change in the exposure.</p>
</section>
<section id="include-the-measured-exposure-with-baseline-covariates" class="level3">
<h3 class="anchored" data-anchor-id="include-the-measured-exposure-with-baseline-covariates">Include the measured exposure with baseline covariates</h3>
<p>Controlling for prior exposure enables the interpretation of the effect estimate as a change in the exposure in a manner akin to a randomised trial. We propose that the effect estimate with prior control for the exposure estimates the “incidence exposure” rather than the “prevalence exposure” [Hernan Danaei, Tavakkoli and Hernán, 2012, Hernán, 2015]. It is crucial to estimate the incidence exposure because if the effects of an exposure are harmful in the short term such that these effects are not subsequently measured, a failure to adjust for prior exposure will yield the illusion that the exposure is beneficial. Furthermore, this approach aids in controlling for unmeasured confounding. For such a confounder to dismiss the observed exposure-outcome association, it would need to do so independently of the prior level of the exposure and outcome.</p>
</section>
<section id="state-the-eligibility-criteria-for-participation" class="level3">
<h3 class="anchored" data-anchor-id="state-the-eligibility-criteria-for-participation">State the eligibility criteria for participation</h3>
<p>This step is invaluable for assessing whether we are answering the causal question that we have asked.</p>
<section id="consider-5" class="level4">
<h4 class="anchored" data-anchor-id="consider-5">Consider:</h4>
<ul>
<li>Generalisability: we cannot evaluate inferences to a target group from the source popuation if we do not describe the source population</li>
<li>Eligibility criteria will help us to ensure whether we have correctly evaluated potential measurement bias/error in our instruments.</li>
</ul>
<p>For example, the New Zealand Attitudes and Values Study is a National Probability study of New Zealanders. The details provided in the supplementary materials describe how individuals were randomly selected from the country’s electoral roll. From these invitations there was typically less than 15% response rate. How might this process of recruitment affect generalisability and transportability of our results?</p>
<ul>
<li>(Aside: discuss per protocol effects/ intention to treat effects)</li>
</ul>
</section>
</section>
<section id="determine-how-missing-data-will-be-handled" class="level3">
<h3 class="anchored" data-anchor-id="determine-how-missing-data-will-be-handled">Determine how missing data will be handled</h3>
<ul>
<li>As we will consider in the upcoming weeks, loss to follow up and non-response opens sources for bias. We must develop a strategy for handling missing data.</li>
</ul>
</section>
<section id="state-a-statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="state-a-statistical-model">State a statistical model</h3>
<p>The models we have considered in this course are G-computation, Inverse Probability of Treatement Weighting, and Doubly-Robust estimation.</p>
</section>
<section id="g-computation-for-subgroup-analysis-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="g-computation-for-subgroup-analysis-algorithm"><strong>G-computation for Subgroup Analysis Algorithm</strong></h3>
<p><strong>Step 1</strong> Estimate the outcome model. Fit a model for the outcome <span class="math inline">Y</span>, conditional on both the exposure <span class="math inline">A</span>, the covariates <span class="math inline">L</span>, and subgroup indicator <span class="math inline">G</span>. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, and subgroups.</p>
<p><span class="math display"> E(Y|A,L,G) = f_Y(A,L,G, \theta_Y) </span></p>
<p>This equation represents the expected value of the outcome <span class="math inline">Y</span> given the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, and subgroup <span class="math inline">G</span> as modeled by the function <span class="math inline">f_Y</span> with parameters <span class="math inline">\theta_Y</span>. This formulation allows for the prediction of the average outcome <span class="math inline">Y</span> given certain values of <span class="math inline">A</span>, <span class="math inline">L</span>, and <span class="math inline">G</span>.</p>
<p><strong>Step 2</strong> Simulate potential outcomes. For each individual <span class="math inline">i</span> in each subgroup <span class="math inline">g</span>, predict their potential outcome <span class="math inline">\hat{Y}_{i,g}(a)</span> under the intervention <span class="math inline">A=a</span> using the estimated outcome model.</p>
<p><span class="math display">\hat{Y}_{i,g}(a) = E[Y|A=a,L_i,G=g; \hat{\theta}_Y]</span></p>
<p>and also under the intervention <span class="math inline">A=a^{\prime}</span>:</p>
<p><span class="math display">\hat{Y}_{i,g}(a^{\prime}) = E[Y|A=a^{\prime},L_i,G=g; \hat{\theta}_Y]</span></p>
<p>This step involves simulating the outcomes under each intervention level for every individual within each subgroup, as if they were exposed to treatment level <span class="math inline">a</span> or <span class="math inline">a^{\prime}</span>.</p>
<p><strong>Step 3</strong> Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{E}[Y(a)|G=g] = \frac{1}{N_g}\sum_{i:G_i=g}^N \hat{Y}_{i,g}(a)</span></p>
<p><span class="math display">\hat{E}[Y(a^{\prime})|G=g] = \frac{1}{N_g}\sum_{i:G_i=g}^N \hat{Y}_{i,g}(a^{\prime})</span></p>
<p>and calculate the estimated difference for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g]</span></p>
<p>This difference represents the average causal effect of changing the exposure from level <span class="math inline">a^{\prime}</span> to level <span class="math inline">a</span> within subgroup <span class="math inline">g</span>.</p>
<p><strong>Step 5</strong> Compare differences in causal effects by subgroups.</p>
<p>Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma}_s = \hat{\delta}_g - \hat{\delta}_{g^{\prime}}</span></p>
<p>This difference <span class="math inline">\hat{\gamma}_s</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g^{\prime}</span>.</p>
<p>Or more fully:</p>
<p><span class="math display">\hat{\gamma}_{s} = \overbrace{\big( E[Y(a)|G=g] - E[Y(a^{\prime})|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(E[Y(a^{\prime})|G=g^{\prime}]- E[Y(a)|G=g^{\prime}]\big)}^{\hat{\delta_{g^{\prime}}}} </span></p>
<p>This difference, <span class="math inline">\gamma_s</span>, represents the difference in the average causal effect of changing the exposure from level <span class="math inline">a^{\prime}</span> to level <span class="math inline">a</span> between subgroup <span class="math inline">g</span> and subgroup <span class="math inline">g^{\prime}</span>. It measures the interaction effect of the exposure <span class="math inline">A</span> and the subgroup <span class="math inline">G</span> on the outcome <span class="math inline">Y</span>.</p>
<p>We use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span></p>
</section>
<section id="inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-algorithm"><strong>Inverse Probability of Treatment Weighting (IPTW) for Subgroup Analysis Algorithm</strong></h3>
<p><strong>Step 1</strong> Estimate the propensity score. The propensity score <span class="math inline">e(L_i, G)</span> is the conditional probability of the exposure <span class="math inline">A_i = 1</span>, given the covariates <span class="math inline">L_i</span> and subgroup indicator <span class="math inline">G</span>. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</p>
<p><span class="math display"> e(L_i, G) = P(A_i = 1 | L_i, G) = f_A(L_i, G; \theta_A) </span></p>
<p>Here, <span class="math inline">f_A(L_i, G; \theta_A)</span> is a function (statistical model) that estimates the probability of the exposure <span class="math inline">A_i = 1</span> given covariates <span class="math inline">L_i</span> and subgroup <span class="math inline">G</span>. The estimated propensity scores are denoted as <span class="math inline">\hat{e}(L_i, G_i)</span>.</p>
<p>Then, we calculate the weights for each individual <span class="math inline">i</span>, denoted as <span class="math inline">v_i</span>, using the estimated propensity score:</p>
<p><span class="math display">v_i = \left(\frac{A_i}{\hat{e}(L_i)} + \frac{1 - A_i}{1 - \hat{e}(L_i)}\right)\bigg|_{G}</span></p>
<p>Note that we estimate propensity scores <em>separately</em> within strata of the subgroup for whom we are interested in effect modification.”</p>
<p><span class="math inline">v_i</span> is the weight for individual <span class="math inline">i</span> in a given subgroup <span class="math inline">G</span>. It calculated using the propensity score estimated within the same subgroup, these weights are then recombined into the full data set with all groups.</p>
<p><strong>Step 2</strong> Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span>, subgroup <span class="math inline">G</span>, and covariates <span class="math inline">L</span>:</p>
<p><span class="math display"> \hat{E}(Y|A, G, L) = f_Y(A, G; \theta_Y, V) </span></p>
<p>where <span class="math inline">f_Y</span> is a weighted function (such as a weighted regression model) with parameters <span class="math inline">\theta_Y</span>, and <span class="math inline">V</span> represents the weights. This formulation allows for the prediction of the outcome <span class="math inline">Y</span> given certain values of <span class="math inline">A</span>, <span class="math inline">G</span>, and <span class="math inline">L</span>, taking into account the inverse probability of treatment weights.</p>
<p><strong>Step 3</strong> Simulate potential outcomes. For each individual <span class="math inline">i</span> in each subgroup <span class="math inline">g</span>, simulate their potential outcome <span class="math inline">\hat{Y}_{i,g}(a)</span> under the hypothetical scenario where everyone in the subgroup is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{Y}_{i,g}(a) = E[Y|A=a,G=g; \hat{\theta}_Y, v_i]</span></p>
<p>and also under the hypothetical scenario where everyone is exposed to intervention <span class="math inline">A=a^{\prime}</span>:</p>
<p><span class="math display">\hat{Y}_{i,g}(a^{\prime}) = E[Y|A=a^{\prime},G=g; \hat{\theta}_Y, v_i]</span></p>
<p><strong>Step 4</strong> Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{E}[Y(a)|G=g] = \sum_{i:G_i=g}^N \hat{Y}_{i,g}(a)</span></p>
<p><span class="math display">\hat{E}[Y(a^{\prime})|G=g] = \sum_{i:G_i=g}^N \hat{Y}_{i,g}(a^{\prime})</span></p>
<p>Then calculate the estimated difference for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g]</span></p>
<p>The difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect of changing the exposure from level <span class="math inline">a^{\prime}</span> to level <span class="math inline">a</span> within each subgroup <span class="math inline">g</span>.</p>
<p><strong>Step 5</strong> Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma}_s = \hat{\delta}_g - \hat{\delta}_{g^{\prime}}</span></p>
<p>This difference <span class="math inline">\hat{\gamma}_s</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g^{\prime}</span>.</p>
<p>We compute standard errors and confidence intervals. Again, to obtain standard errors and confidence intervals for these differences in subgroup-specific causal effects, we use simulation-based inference methods <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
</section>
<section id="doubly-robust-estimation-for-subgroup-analysis-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="doubly-robust-estimation-for-subgroup-analysis-algorithm">Doubly Robust Estimation for Subgroup Analysis Algorithm</h3>
<p>Doubly Robust Estimation is a powerful technique that combines the strengths of both the IPTW and G-computation methods. It uses both the propensity score model and the outcome model, which makes it doubly robust: it produces unbiased estimates if either one of the models is correctly specified.</p>
<p><strong>Step 1</strong> Estimate the propensity score. The propensity score <span class="math inline">e(L_i, G)</span> is the conditional probability of the exposure <span class="math inline">A_i = 1</span>, given the covariates <span class="math inline">L_i</span> and subgroup indicator <span class="math inline">G</span>. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</p>
<p><span class="math display"> e(L_i, G) = P(A_i = 1 | L_i, G) = f_A(L_i, G; \theta_A) </span></p>
<p>Here, <span class="math inline">f_A(L_i, G; \theta_A)</span> is a function (statistical model) that estimates the probability of the exposure <span class="math inline">A_i = 1</span> given covariates <span class="math inline">L_i</span> and subgroup <span class="math inline">G</span>. The estimated propensity scores are denoted as <span class="math inline">\hat{e}(L_i, G_i)</span>.</p>
<p>Then, we calculate the weights for each individual <span class="math inline">i</span>, denoted as <span class="math inline">v_i</span>, using the estimated propensity score:</p>
<p><span class="math display">v_i = \left(\frac{A_i}{\hat{e}(L_i)} + \frac{1 - A_i}{1 - \hat{e}(L_i)}\right)\bigg|_{G}</span></p>
<p>Note that we estimate propensity scores <strong>separately</strong> within strata of the subgroup for whom we are interested in effect modification.”</p>
<p><span class="math inline">v_i</span> is the weight for individual <span class="math inline">i</span> in a given subgroup <span class="math inline">G</span>. It calculated using the propensity score estimated within the same subgroup, these weights are then recombined into the full data set with all groups.</p>
<p><strong>Step 2</strong> Estimate the outcome model.</p>
<p>Fit a model for the outcome <span class="math inline">Y</span>, conditional on both the exposure <span class="math inline">A</span>, the covariates <span class="math inline">L</span>, subgroup indicator <span class="math inline">G</span>, and the propensity scores <span class="math inline">V</span>. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, and subgroups.</p>
<p><span class="math display"> E(Y|A,L,V,G) = f_Y(A,L,V,G, \theta_Y) </span></p>
<p>This equation represents the expected value of the outcome <span class="math inline">Y</span> given the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, the propensity score <span class="math inline">v_i</span>, and subgroup <span class="math inline">G</span> as modeled by the function <span class="math inline">f_Y</span> with parameters <span class="math inline">\theta_Y</span>. This formulation allows for the prediction of the average outcome <span class="math inline">Y</span> given certain values of <span class="math inline">A</span>, <span class="math inline">L</span>, <span class="math inline">V</span>,and <span class="math inline">G</span>.</p>
<p><strong>Step 3</strong> Simulate potential outcomes. For each individual <span class="math inline">i</span> in each subgroup <span class="math inline">g</span>, simulate their potential outcome <span class="math inline">\hat{Y}_{i,g}(a)</span> under the hypothetical scenario where everyone in the subgroup is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{Y}_{i,g}(a) = E[Y|A=a,G=g; \hat{\theta}_Y,L_i, v_i]</span></p>
<p>and also under the hypothetical scenario where everyone is exposed to intervention <span class="math inline">A=a^{\prime}</span>:</p>
<p><span class="math display">\hat{Y}_{i,g}(a^{\prime}) = E[Y|A=a^{\prime},G=g; \hat{\theta}_Y,,L_i, v_i]</span></p>
<p><strong>Step 4</strong> Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{E}[Y(a)|G=g] = \sum_{i:G_i=g}^N \hat{Y}_{i,g}(a)</span></p>
<p><span class="math display">\hat{E}[Y(a^{\prime})|G=g] = \sum_{i:G_i=g}^N  \hat{Y}_{i,g}(a^{\prime})</span></p>
<p>Then calculate the estimated difference for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g]</span></p>
<p>The difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect of changing the exposure from level <span class="math inline">a^{\prime}</span> to level <span class="math inline">a</span> within each subgroup <span class="math inline">g</span>.</p>
<p><strong>Step 5</strong> Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma}_s = \hat{\delta}_g - \hat{\delta}_{g^{\prime}}</span></p>
<p>This difference <span class="math inline">\hat{\gamma}_s</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g^{\prime}</span>.</p>
<p>Again we can see this explicitly:</p>
<p><span class="math display">\hat{\gamma}_{s} = \overbrace{\big( E[Y(a)|G=g] - E[Y(a^{\prime})|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(E[Y(a^{\prime})|G=g^{\prime}]- E[Y(a)|G=g^{\prime}]\big)}^{\hat{\delta_{g^{\prime}}}} </span></p>
<p>We again calculate standard errors and confidence intervals using simulation-based inference methods <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>. This helps to quantify the uncertainty around the estimated causal effects.</p>
</section>
<section id="provided-detailed-reporting-checklist-as-follows" class="level3">
<h3 class="anchored" data-anchor-id="provided-detailed-reporting-checklist-as-follows">Provided Detailed Reporting: Checklist as follows</h3>
<section id="have-a-question" class="level4">
<h4 class="anchored" data-anchor-id="have-a-question">Have a question</h4>
<ul>
<li>Did I state my question? No<span class="math inline">\to</span>state it. Yes<span class="math inline">\to</span>proceed.</li>
<li>So what? Did I explain why this question is important? No-&gt; explain. Yes <span class="math inline">\to</span> proceed.</li>
<li>Do I have a causal question. No <span class="math inline">\to</span> Stop. Your question might not be important, return to the previous step. Yes<span class="math inline">\to</span>Proceed.</li>
<li>Do you have a question about a subgroup – for example a cultural group? Yes<span class="math inline">\to</span>proceed. No that’s okay but your assessment requires a subgroup analysis. Return to the start and develop a subgroup analysis question then <span class="math inline">\to</span> proceed.</li>
<li>Are you familiar with the potential outcomes framework such that you can explain the following: why are individual causal effects not identified? how do experiments obtain average causal effects? Can you roughly explain the fundamental assumptions of causal inference? Can you roughly explain how causal effects are estimated in observational data by predicting potential outcomes for everyone under specific levels of an exposure, regardless of whether they recieved it? No <span class="math inline">\to</span> study your notes and the course materials. If you still can’t understand <span class="math inline">\to</span> see me. Yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="data" class="level4">
<h4 class="anchored" data-anchor-id="data">Data</h4>
<ul>
<li>Do I have experimental data? Yes <span class="math inline">\to</span> You are not in this course. No <span class="math inline">\to</span> you must emulate a target trial, proceed.</li>
<li>Do I have time-series data. No <span class="math inline">\to</span> stop, you should not ask a causal question. Yes <span class="math inline">\to</span> proceed.</li>
<li>Do have at least three-waves of data. No <span class="math inline">\to</span> stop, danger zone. Confounding control requires much stronger assumptions. Yes <span class="math inline">\to</span> proceed.</li>
<li>Are the time-series data the NZAVS simulated data? No <span class="math inline">\to</span> Talk to me. Yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="outcome" class="level4">
<h4 class="anchored" data-anchor-id="outcome">Outcome</h4>
<ul>
<li>Have you defined the outcome variable <em>Y</em>? No <span class="math inline">\to</span>write it down. Yes <span class="math inline">\to</span> proceed.</li>
<li>Is there more than one outcome? No <span class="math inline">\to</span> proceed. Yes, write them down, <span class="math inline">\to</span> proceed.</li>
<li>Can you explain how your outcome variable/s are relevant to your question? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Do you have a binary outcome? Yes <span class="math inline">\to</span> Is it rare? <span class="math inline">\to</span> you may use logistic regression, note this, then <span class="math inline">\to</span> proceed. No? Is your outcome continuous? Consider whether to z-transform it, consider whether to truncate it into categories (after expert consultation). Note this, then <span class="math inline">\to</span> proceed.</li>
<li>Does your outcome appear after your exposure? Yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="exposure" class="level4">
<h4 class="anchored" data-anchor-id="exposure">Exposure</h4>
<ul>
<li>Have you defined the exposure variable <em>A</em>? No <span class="math inline">\to</span>write it down. Yes <span class="math inline">\to</span> proceed.</li>
<li>Is there more than one exposure? No <span class="math inline">\to</span> stop, you’re confused. Yes <span class="math inline">\to</span> proceed.</li>
<li>Can you explain how your exposure variable is relevant to your question? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Is it conceptually possible to intervene on your exposure at all levels of the covariates (positivity)? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Can you interpret what it would mean to intervene on the exposure (consistency)? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Are the different versions of the exposure conditionally exchangeable conditional on measured baseline confounders. Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Do you have a binary exposure? Yes note this, then <span class="math inline">\to</span> proceed. No? Is your exposure continuous? Z-transform it, Consider whether to truncate it into categories (after expert consultation). Note this, then <span class="math inline">\to</span> proceed.</li>
<li>Does your exposure appear after before your outcome? Only if yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="confounders" class="level4">
<h4 class="anchored" data-anchor-id="confounders">Confounders</h4>
<ul>
<li>Have you defined your baseline confounders <span class="math inline">L</span> Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Have you justified why the baseline confounders may affect both <span class="math inline">A</span> and <span class="math inline">Y</span>. Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Are the baseline confounders measured before the exposure. Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Is the baseline measure of the exposure included in the set of baseline confounders? Only if yes <span class="math inline">\to</span> proceed. Is the baseline outcome included in the set of baseline confounders? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Are the baseline confounders sufficient to ensure balance on the exposure, such that <span class="math inline">A \coprod Y|L</span>. If not, write this down and clarify how you will address the problem in your sensitivity analysis, then <span class="math inline">\to</span> proceed.</li>
<li>Are the confounders continuous? <span class="math inline">\to</span> convert them to z-scores.</li>
<li>Are the confounders binary? You may convert them to z-scores</li>
<li>Are the confounders categorical and have three or more levels? Do not convert them to z-scores. You may now <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="causal-diagramme-with-unmeasured-confounders" class="level4">
<h4 class="anchored" data-anchor-id="causal-diagramme-with-unmeasured-confounders">Causal Diagramme with Unmeasured Confounders</h4>
<ul>
<li>Do previous science suggestion there may be unmeasured confounders? No <span class="math inline">\to</span> learn more science. Yes <span class="math inline">\to</span> briefly explain and <span class="math inline">\to</span> proceed.</li>
<li>Have you drawn a causal diagramme (DAG) to clarify both measured and unmeasured sources of confounding? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Is there a possiblity of M-Bias? I don’t know what M-bias is. That’s OK, we’ll discuss later <span class="math inline">\to</span> proceed.</li>
<li>Have I described sources of bias from measurement error differential or correlated measurement errors between the exposure and outcome? That’s OK, we’ll discuss later<span class="math inline">\to</span> proceed.</li>
<li>Do the nodes on my DAG have time indicators so that I can ensure temporal order is correct? Only if yes <span class="math inline">\to</span> proceed?</li>
<li>Is my DAG organised so that time follows in consistent direction? No? That’s OK, but as you get more experienced you will do better, for now <span class="math inline">\to</span> proceed?</li>
</ul>
</section>
<section id="estimand" class="level4">
<h4 class="anchored" data-anchor-id="estimand">Estimand</h4>
<ul>
<li>Is my causal estimand one of these:</li>
</ul>
<p><span class="math display">ATE_{G,\text{risk difference}} = E[Y(1) - Y(0)|G, L]</span></p>
<p><span class="math display">ATE_{G,\text{risk ratio}} = \frac{E[Y(1)|G, L]}{E[Y(0)|G, L]}</span></p>
<p>if yes, good you are in the right course. You may <span class="math inline">\to</span> proceed.</p>
</section>
<section id="what-is-my-source-and-target-population" class="level4">
<h4 class="anchored" data-anchor-id="what-is-my-source-and-target-population">What is my source and target population?</h4>
<ul>
<li>Have I distinguished between my source and target population? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Have I considered whether my results generalise to the source population? Have I considered whether my results transport to a different population? Only if yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
<section id="eligibility-criteria" class="level4">
<h4 class="anchored" data-anchor-id="eligibility-criteria">Eligibility criteria?</h4>
<ul>
<li>Have I stated eligibility criteria for the study? Only if yes <span class="math inline">\to</span> proceed.</li>
</ul>
</section>
</section>
<section id="desription-of-the-sample-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="desription-of-the-sample-characteristics">Desription of the sample characteristics</h3>
<ul>
<li>Have I provided the desciptive statistics for demographic information taken at baseline? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Have I demonstrated the magnitudes of change in the exposure from baseline to the exposure interval? Only if yes <span class="math inline">\to</span> proceed.</li>
<li>Have I included references to where my audience can find more information about the sample? Only if yes <span class="math inline">\to</span> proceed.</li>
<li></li>
</ul>
</section>
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">Inference</h3>
<ul>
<li>Take care when describing for whome the results generalise.</li>
</ul>
<!-- ### What we have not done -->
<!-- We have not addressed:  -->
<!-- - measurement error. Our graphs do not incorporate it.  -->
<!-- - selection bias -->
<!-- - Outcome-wide studies -->
<!-- - Sampling weights.  -->



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-greifer2023" class="csl-entry" role="listitem">
Greifer, Noah, Steven Worthington, Stefano Iacus, and Gary King. 2023. <em>Clarify: Simulation-Based Inference for Regression Models</em>. <a href="https://iqss.github.io/clarify/">https://iqss.github.io/clarify/</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>