<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023 - Temporal Causal Diagrams: Unveiling Causal Order and Indexing Nodes by Time</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/common_graphs.html" rel="" target="">
 <span class="dropdown-text">Background: Causal Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/measurement_error.html" rel="" target="">
 <span class="dropdown-text">Background: Causal Graphs: Measurement Error</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/index.html" rel="" target="">
 <span class="dropdown-text">Preliminaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html" rel="" target="">
 <span class="dropdown-text">1: Asking questions in cross-cultural psychology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html" rel="" target="">
 <span class="dropdown-text">2: Getting started with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html" rel="" target="">
 <span class="dropdown-text">3: Lost in Translation? Measurement and Language</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html" rel="" target="">
 <span class="dropdown-text">4: Dealing with Data (Factor Analysis)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/05-content.html" rel="" target="">
 <span class="dropdown-text">5: Dealing with Data (Multi-Group CFA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/06-content.html" rel="" target="">
 <span class="dropdown-text">6: Dealing with Data (Partial Invariance)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/07-content.html" rel="" target="">
 <span class="dropdown-text">7: Causal Inference: Causal Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/08-content.html" rel="" target="">
 <span class="dropdown-text">8: Causal Inference: Target Trial Emulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/09-content.html" rel="" target="">
 <span class="dropdown-text">9: Causal inference: Reconsidering measurement and selection biases</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/10-content.html" rel="" target="">
 <span class="dropdown-text">10: Causal Inference: Cross-Cultural Experiments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/11-content.html" rel="" target="">
 <span class="dropdown-text">11: Ethics and Ownership</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/12-content.html" rel="" target="">
 <span class="dropdown-text">12: Future Horizons</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Temporal Causal Diagrams: Unveiling Causal Order and Indexing Nodes by Time</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joseph Bulbulia </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#common-causal-graphs" id="toc-common-causal-graphs" class="nav-link active" data-scroll-target="#common-causal-graphs">Common Causal Graphs</a></li>
  <li><a href="#graphs-of-canonical-confounders" id="toc-graphs-of-canonical-confounders" class="nav-link" data-scroll-target="#graphs-of-canonical-confounders">Graphs of Canonical confounders</a>
  <ul class="collapse">
  <li><a href="#confounding-by-common-cause." id="toc-confounding-by-common-cause." class="nav-link" data-scroll-target="#confounding-by-common-cause.">Confounding by Common Cause.</a></li>
  <li><a href="#solution-adjust-for-the-pre-exposure-confounder" id="toc-solution-adjust-for-the-pre-exposure-confounder" class="nav-link" data-scroll-target="#solution-adjust-for-the-pre-exposure-confounder">Solution: adjust for the pre-exposure confounder</a></li>
  <li><a href="#second-problem-collider-stratification-conditioning-on-a-common-effect." id="toc-second-problem-collider-stratification-conditioning-on-a-common-effect." class="nav-link" data-scroll-target="#second-problem-collider-stratification-conditioning-on-a-common-effect.">Second problem: Collider Stratification: conditioning on a common effect.</a></li>
  <li><a href="#solution-ensure-all-confounders-are-measured-before-the-exposure" id="toc-solution-ensure-all-confounders-are-measured-before-the-exposure" class="nav-link" data-scroll-target="#solution-ensure-all-confounders-are-measured-before-the-exposure">Solution: ensure all confounders are measured before the exposure</a></li>
  <li><a href="#third-problem-conditioning-on-a-mediator" id="toc-third-problem-conditioning-on-a-mediator" class="nav-link" data-scroll-target="#third-problem-conditioning-on-a-mediator">Third problem: conditioning on a mediator</a></li>
  <li><a href="#solution-ensure-confounders-are-measured-before-the-exposure." id="toc-solution-ensure-confounders-are-measured-before-the-exposure." class="nav-link" data-scroll-target="#solution-ensure-confounders-are-measured-before-the-exposure.">Solution: ensure confounders are measured before the exposure.</a></li>
  <li><a href="#fourth-problem-conditioning-on-a-descendant" id="toc-fourth-problem-conditioning-on-a-descendant" class="nav-link" data-scroll-target="#fourth-problem-conditioning-on-a-descendant">Fourth problem: conditioning on a descendant</a></li>
  <li><a href="#solution-yet-again-ensure-that-counfounders-are-measured-before-the-exposure" id="toc-solution-yet-again-ensure-that-counfounders-are-measured-before-the-exposure" class="nav-link" data-scroll-target="#solution-yet-again-ensure-that-counfounders-are-measured-before-the-exposure">Solution: (yet again!) ensure that counfounders are measured before the exposure</a></li>
  <li><a href="#this-ends-the-examples-of-cannoical-casual-diagrammes" id="toc-this-ends-the-examples-of-cannoical-casual-diagrammes" class="nav-link" data-scroll-target="#this-ends-the-examples-of-cannoical-casual-diagrammes">This ends the examples of cannoical casual diagrammes</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#common-cause-of-exposure-and-outcome." id="toc-common-cause-of-exposure-and-outcome." class="nav-link" data-scroll-target="#common-cause-of-exposure-and-outcome.">Common cause of exposure and outcome.</a>
  <ul class="collapse">
  <li><a href="#solution-adjust-for-confounder" id="toc-solution-adjust-for-confounder" class="nav-link" data-scroll-target="#solution-adjust-for-confounder">Solution: Adjust for Confounder</a></li>
  <li><a href="#bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" id="toc-bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" class="nav-link" data-scroll-target="#bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2">Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2</a></li>
  <li><a href="#solution-adjust-for-confounder-at-baseline" id="toc-solution-adjust-for-confounder-at-baseline" class="nav-link" data-scroll-target="#solution-adjust-for-confounder-at-baseline">Solution: adjust for confounder at baseline</a></li>
  <li><a href="#a-more-thorough-confounding-control" id="toc-a-more-thorough-confounding-control" class="nav-link" data-scroll-target="#a-more-thorough-confounding-control">A more thorough confounding control</a></li>
  <li><a href="#generic-3-wave-panel-design-vanderweeele-2020" id="toc-generic-3-wave-panel-design-vanderweeele-2020" class="nav-link" data-scroll-target="#generic-3-wave-panel-design-vanderweeele-2020">Generic 3-wave panel design (VanderWeeele 2020)</a></li>
  <li><a href="#selection-bias-there-are-several-types" id="toc-selection-bias-there-are-several-types" class="nav-link" data-scroll-target="#selection-bias-there-are-several-types">Selection bias: there are several types</a></li>
  </ul></li>
  <li><a href="#important-causal-diagrammes" id="toc-important-causal-diagrammes" class="nav-link" data-scroll-target="#important-causal-diagrammes">Important Causal Diagrammes</a></li>
  <li><a href="#how-do-we-draw-interactions" id="toc-how-do-we-draw-interactions" class="nav-link" data-scroll-target="#how-do-we-draw-interactions">How do we draw interactions?</a></li>
  <li><a href="#common-cause-of-exposure-and-outcome.-1" id="toc-common-cause-of-exposure-and-outcome.-1" class="nav-link" data-scroll-target="#common-cause-of-exposure-and-outcome.-1">Common cause of exposure and outcome.</a>
  <ul class="collapse">
  <li><a href="#another-graph-for-interaction" id="toc-another-graph-for-interaction" class="nav-link" data-scroll-target="#another-graph-for-interaction">Another graph for interaction</a></li>
  <li><a href="#m-bias" id="toc-m-bias" class="nav-link" data-scroll-target="#m-bias">M-Bias</a></li>
  <li><a href="#what-if-mediation-is-of-interest" id="toc-what-if-mediation-is-of-interest" class="nav-link" data-scroll-target="#what-if-mediation-is-of-interest">What if mediation is of interest?</a></li>
  <li><a href="#confounder-treatment-feedback" id="toc-confounder-treatment-feedback" class="nav-link" data-scroll-target="#confounder-treatment-feedback">Confounder-Treatment Feedback</a></li>
  </ul></li>
  <li><a href="#multiple-versions-of-treatment" id="toc-multiple-versions-of-treatment" class="nav-link" data-scroll-target="#multiple-versions-of-treatment">Multiple Versions of Treatment</a></li>
  <li><a href="#does-the-multiple-versions-of-treatments-approach-save-us" id="toc-does-the-multiple-versions-of-treatments-approach-save-us" class="nav-link" data-scroll-target="#does-the-multiple-versions-of-treatments-approach-save-us">Does the Multiple Versions of Treatments Approach Save Us?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="common-causal-graphs" class="level2">
<h2 class="anchored" data-anchor-id="common-causal-graphs">Common Causal Graphs</h2>
</section>
<section id="graphs-of-canonical-confounders" class="level2">
<h2 class="anchored" data-anchor-id="graphs-of-canonical-confounders">Graphs of Canonical confounders</h2>
<section id="confounding-by-common-cause." class="level3">
<h3 class="anchored" data-anchor-id="confounding-by-common-cause.">Confounding by Common Cause.</h3>
<p>The problem of confounding by common cause arises when there is an unmeasured or unaccounted-for variable, denoted as “L,” that influences both the treatment variable, denoted by <span class="math inline">A,</span> and the outcome variable, denoted as <span class="math inline">Y.</span> This confounder, <span class="math inline">L</span>, creates an association between <span class="math inline">A</span> and <span class="math inline">Y</span> that is not solely due to the direct causal effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. Instead, the observed association between <span class="math inline">A</span> and <span class="math inline">Y</span> may be partially or entirely driven by the presence of <span class="math inline">L</span>, making it difficult to isolate and accurately estimate the true causal effect of <span class="math inline">A</span> on <span class="math inline">Y</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-common-cause" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-common-cause-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Counfounding by common cause.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-adjust-for-the-pre-exposure-confounder" class="level3">
<h3 class="anchored" data-anchor-id="solution-adjust-for-the-pre-exposure-confounder">Solution: adjust for the pre-exposure confounder</h3>
<p>Confounding by common cause can be addressed by adjusting for it. If <span class="math inline">L</span> is measured before the treatment (or exposure) is assigned, we may adjust for this confounder to account for its influence. Typically we adjust through through statistical techniques such as stratification, regression, matching, or inverse probability of treatment weighting. Sucg adjustment helps to mitigate the bias caused by the confounder, allowing for a more accurate estimation of the true causal relationship.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-common-cause-solution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-common-cause-solution-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Solution: adjust for pre-exposure confounder.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="second-problem-collider-stratification-conditioning-on-a-common-effect." class="level3">
<h3 class="anchored" data-anchor-id="second-problem-collider-stratification-conditioning-on-a-common-effect.">Second problem: Collider Stratification: conditioning on a common effect.</h3>
<p>Conditioning on a common effect refers to a situation where there is a variable, <span class="math inline">L</span>, is affected by both the treatment <span class="math inline">A</span> and an outcome <span class="math inline">Y</span>. Conditioning on <span class="math inline">L</span> creates a spurious association between <span class="math inline">A</span> and <span class="math inline">Y</span>, biasing the true causal relationship. This occurs because the relationship between <span class="math inline">A</span> and <span class="math inline">Y</span> becomes confounded by the common effect <span class="math inline">L</span>. The observed association between <span class="math inline">A</span> and <span class="math inline">Y</span> may be solely driven by the influence of <span class="math inline">L</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-common-effect" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-common-effect-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Solution: ensure confounder is measured prior to the exposure.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-ensure-all-confounders-are-measured-before-the-exposure" class="level3">
<h3 class="anchored" data-anchor-id="solution-ensure-all-confounders-are-measured-before-the-exposure">Solution: ensure all confounders are measured before the exposure</h3>
<p>To address the problem of conditioning on a common effect, it is crucial to ensure that every potential confounder <span class="math inline">L</span> that may affect <span class="math inline">A</span> is measured before <span class="math inline">A</span>. If such temporal order is preserved, <span class="math inline">L</span> cannot be an effect of <span class="math inline">A</span>, and thus neither of <span class="math inline">Y</span>. By measuring all relevant confounders in advance, researchers can minimize bias and obtain more reliable estimates of the true causal relationship between A and Y. Note that collider stratification may arise even if <span class="math inline">L</span> occurs before <span class="math inline">A</span>, when <span class="math inline">L</span> does not affect <span class="math inline">A</span> or <span class="math inline">Y</span>. This is called M-bias. We describe this case below. Note, however, that if <span class="math inline">L</span> is not a common cause of <span class="math inline">A</span> and <span class="math inline">Y</span>, <span class="math inline">L</span> should not be included in our model because it is not a source of confounding.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-common-effect-solution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-common-effect-solution-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Causal graph reveals bias: solve by stratification</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="third-problem-conditioning-on-a-mediator" class="level3">
<h3 class="anchored" data-anchor-id="third-problem-conditioning-on-a-mediator">Third problem: conditioning on a mediator</h3>
<p>Conditioning on a mediator refers to a situation where <span class="math inline">L</span> lies on the causal pathway between the treatment <span class="math inline">A</span> and the outcome <span class="math inline">Y</span>. Conditioning on <span class="math inline">L</span> can lead to biased estimates by blocking or distort the true causal pathway between <span class="math inline">A</span> and <span class="math inline">Y</span>, obscuring the total effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. Where <span class="math inline">L</span> is a collider between <span class="math inline">A</span> and an unmeasured confouder <span class="math inline">U</span>, then including <span class="math inline">L</span> may increase the strength of association between <span class="math inline">A</span> and <span class="math inline">Y</span>. We review this second possibility next. In either case, unless one is interested in mediation analysis (see below), conditioning on a post-treatment variable is always a bad idea.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-mediator" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-mediator-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Third problem: conditioning on a mediator.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-ensure-confounders-are-measured-before-the-exposure." class="level3">
<h3 class="anchored" data-anchor-id="solution-ensure-confounders-are-measured-before-the-exposure.">Solution: ensure confounders are measured before the exposure.</h3>
<p>To address the problem of mediator bias, do not condition on a mediator. Ensure that <span class="math inline">L</span> occurs before <span class="math inline">A</span> (and <span class="math inline">Y</span>). Again we discover the importance of an explicit temporal ordering for our variables.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-mediator-solution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-mediator-solution-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Do not condition on a mediator</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="fourth-problem-conditioning-on-a-descendant" class="level3">
<h3 class="anchored" data-anchor-id="fourth-problem-conditioning-on-a-descendant">Fourth problem: conditioning on a descendant</h3>
<p>Say <span class="math inline">X</span> is a cause of <span class="math inline">X*</span>. There is a theorem that proves that when we condition on <span class="math inline">X*</span> we partially condition on <span class="math inline">X</span>. There are both negative and positive implications for causal estimation. First the negative. Suppose there is a confounder <span class="math inline">L</span> that is caused by an unobserved variable <span class="math inline">U</span>, and is affected by the treatment <span class="math inline">A</span>. Suppose further that <span class="math inline">U</span> causes the outcome <span class="math inline">Y</span>. In this scenario, as described in <a href="#fig-dag-descendent">Figure&nbsp;7</a>, conditioning on <span class="math inline">L</span>, which is a descendant of <span class="math inline">A</span> and <span class="math inline">U</span>, can lead to a spurious association between <span class="math inline">A</span> and <span class="math inline">Y</span> through the path <span class="math inline">A \to L \to U \to Y</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-descendent" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-descendent-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Conditioning on a descendant</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-yet-again-ensure-that-counfounders-are-measured-before-the-exposure" class="level3">
<h3 class="anchored" data-anchor-id="solution-yet-again-ensure-that-counfounders-are-measured-before-the-exposure">Solution: (yet again!) ensure that counfounders are measured before the exposure</h3>
<p>Ensuring the confounder (L) is measured before the exposure (A) has two beneficial properties. Firstly, if <span class="math inline">L</span> is a confounder, that is, if <span class="math inline">L</span> is a variable which if we fail to condition on it will bias the association between treatment and outcome, the strategy of including only pre-treatment indicators of <span class="math inline">L</span> will eliminate collider bias. Secondly, there is the positive side to the theorem that conditioning on a descendent is equivalent to partially conditioning on its parent: if an unmeasured confounder is associated with both <span class="math inline">A</span>, <span class="math inline">Y</span>, and <span class="math inline">L</span>, then adjusting for <span class="math inline">L</span> helps to reduce confounding caused by the unmeasured confounder. By obtaining measure of <span class="math inline">L</span> that occur before <span class="math inline">A</span>, such advantages can be achieved, allowing for more accurate estimation for the causal effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. We use the convention of a blue dotted arrow to indicate that the association between <span class="math inline">A</span> and <span class="math inline">Y</span> may still be biased, but that bias is reduced by inluding <span class="math inline">L</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-descendent-solution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-descendent-solution-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Solution: conditioning on a descendent is part of the solution, not the problem, when baseline confounders are measured before the exposure.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="this-ends-the-examples-of-cannoical-casual-diagrammes" class="level3">
<h3 class="anchored" data-anchor-id="this-ends-the-examples-of-cannoical-casual-diagrammes">This ends the examples of cannoical casual diagrammes</h3>
</section>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>Next some worked examples.</p>
</section>
<section id="common-cause-of-exposure-and-outcome." class="level2">
<h2 class="anchored" data-anchor-id="common-cause-of-exposure-and-outcome.">Common cause of exposure and outcome.</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Common cause of exposure and outcome: example</figcaption>
</figure>
</div>
</div>
</div>
<section id="solution-adjust-for-confounder" class="level3">
<h3 class="anchored" data-anchor-id="solution-adjust-for-confounder">Solution: Adjust for Confounder</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Solution to this problem.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" class="level3">
<h3 class="anchored" data-anchor-id="bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2">Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Causal graph reveals bias from pre-exosure indicator</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-adjust-for-confounder-at-baseline" class="level3">
<h3 class="anchored" data-anchor-id="solution-adjust-for-confounder-at-baseline">Solution: adjust for confounder at baseline</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Solution to this problem</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="a-more-thorough-confounding-control" class="level3">
<h3 class="anchored" data-anchor-id="a-more-thorough-confounding-control">A more thorough confounding control</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Causal graph:more general panel design</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="generic-3-wave-panel-design-vanderweeele-2020" class="level3">
<h3 class="anchored" data-anchor-id="generic-3-wave-panel-design-vanderweeele-2020">Generic 3-wave panel design (VanderWeeele 2020)</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Causal graph: three-wave panel design</figcaption>
</figure>
</div>
</div>
</div>
<!-- ### Selection bias version 1 -->
<!-- ```{tikz} -->
<!-- #| label: fig-dag-7 -->
<!-- #| fig-cap: "Causal graph: three-wave panel design with selection bias" -->
<!-- #| out-width: 100% -->
<!-- #| echo: false -->
<!-- \usetikzlibrary{positioning} -->
<!-- \usetikzlibrary{shapes.geometric} -->
<!-- \usetikzlibrary{arrows} -->
<!-- \usetikzlibrary{decorations} -->
<!-- \tikzstyle{Arrow} = [->, thin, preaction = {decorate}] -->
<!-- \tikzset{>=latex} -->
<!-- \begin{tikzpicture}[{every node/.append style}=draw] -->
<!-- \node [rectangle, draw=white] (U) at (0, 0) {U}; -->
<!-- \node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y}; -->
<!-- \node [rectangle, draw=white] (A) at (4, 0) {t1/A}; -->
<!-- \node [ellipse, draw=white] (Y) at (6, 0) {t2/Y}; -->
<!-- \node [rectangle, draw=black] (S) at (8, 0) {S}; -->
<!-- \draw [-latex, draw=black] (U) to (L); -->
<!-- \draw [-latex, draw=black] (L) to (A); -->
<!-- \draw [-latex, bend left=50, draw=black] (L) to (Y); -->
<!-- \draw [-latex, bend right=50, draw=black, dotted] (U) to (Y); -->
<!-- \draw [-latex, bend left=50, draw=black, dotted] (U) to (A); -->
<!-- \draw [-latex, draw=black] (Y) to (S); -->
<!-- \draw [-latex, bend right, draw=black] (A) to (S); -->
<!-- \draw [-latex, draw=red, dashed] (A) to (Y); -->
<!-- \end{tikzpicture} -->
<!-- ``` -->
</section>
<section id="selection-bias-there-are-several-types" class="level3">
<h3 class="anchored" data-anchor-id="selection-bias-there-are-several-types">Selection bias: there are several types</h3>
<section id="unmeasured-confounder-affects-selection-and-the-outcome" class="level4">
<h4 class="anchored" data-anchor-id="unmeasured-confounder-affects-selection-and-the-outcome">Unmeasured confounder affects selection and the outcome</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;15: Causal graph: three-wave panel design with selection bias</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="unmeasured-confounder-affects-a-measured-confounder-of-selection-and-the-outcome-and-there-are-unmeasured-confourders-that-affect-the-measured-confounder" class="level4">
<h4 class="anchored" data-anchor-id="unmeasured-confounder-affects-a-measured-confounder-of-selection-and-the-outcome-and-there-are-unmeasured-confourders-that-affect-the-measured-confounder">Unmeasured confounder affects a measured confounder of selection and the outcome, and there are unmeasured confourders that affect the measured confounder</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-8-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-8-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;16: Causal graph: three-wave panel design with selection bias: example 2</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="unmeasured-confounder-affects-slection-into-the-study-and-also-attrition" class="level4">
<h4 class="anchored" data-anchor-id="unmeasured-confounder-affects-slection-into-the-study-and-also-attrition">Unmeasured confounder affects slection into the study and also attrition</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-8-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-8-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;17: Causal graph: three-wave panel design with selection bias: selection into the study (D) affects attrition</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="outcome-and-exposure-affect-attrition" class="level4">
<h4 class="anchored" data-anchor-id="outcome-and-exposure-affect-attrition">Outcome and exposure affect attrition</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-8-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-8-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;18: Causal graph:outcome and exposure affect attrition (Y measured with directed measurement error)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="outcome-and-exposure-affect-attrition-we-may-approach-this-problem-as-one-of-directed-measurement-error." class="level4">
<h4 class="anchored" data-anchor-id="outcome-and-exposure-affect-attrition-we-may-approach-this-problem-as-one-of-directed-measurement-error.">Outcome and exposure affect attrition: we may approach this problem as one of directed measurement error.</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-directed-measurement-error" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-directed-measurement-error-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;19: TBA</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="important-causal-diagrammes" class="level2">
<h2 class="anchored" data-anchor-id="important-causal-diagrammes">Important Causal Diagrammes</h2>
</section>
<section id="how-do-we-draw-interactions" class="level2">
<h2 class="anchored" data-anchor-id="how-do-we-draw-interactions">How do we draw interactions?</h2>
</section>
<section id="common-cause-of-exposure-and-outcome.-1" class="level2">
<h2 class="anchored" data-anchor-id="common-cause-of-exposure-and-outcome.-1">Common cause of exposure and outcome.</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modfication" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-effect-modfication-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;20: A simple graph for effect-modification.</figcaption>
</figure>
</div>
</div>
</div>
<section id="another-graph-for-interaction" class="level3">
<h3 class="anchored" data-anchor-id="another-graph-for-interaction">Another graph for interaction</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modfication-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-effect-modfication-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;21: A simple graph for effect-modification.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="m-bias" class="level3">
<h3 class="anchored" data-anchor-id="m-bias">M-Bias</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-m-bias" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-m-bias-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;22: M-bias: confounding control by including previous measures of the outcome</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="what-if-mediation-is-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="what-if-mediation-is-of-interest">What if mediation is of interest?</h3>
<p>Consider the assumptions required for mediation analysis:</p>
<ol type="1">
<li>No unmeasured exposure-outcome confounders given <span class="math inline">L</span></li>
</ol>
<p><span class="math display">Y^{am}\coprod A|L</span> 2. No unmeasured meadiator-outcome confounders given <span class="math inline">L</span></p>
<p><span class="math display">Y^{am}\coprod M|L</span></p>
<ol start="3" type="1">
<li>No unmeasured exposure-mediator confounders given <span class="math inline">L</span></li>
</ol>
<p><span class="math display">M^{a}\coprod A|L</span></p>
<ol start="4" type="1">
<li>No mediator-outcome confounder affected by the exposure (no red arrow)</li>
</ol>
<p><span class="math display">Y^{am}\coprod M^{a*}|L</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-mediation-assuptions" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-mediation-assuptions-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;23: Assumptions for mediation analysis</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="confounder-treatment-feedback" class="level3">
<h3 class="anchored" data-anchor-id="confounder-treatment-feedback">Confounder-Treatment Feedback</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;24: Confounder Treatement Feedback</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="multiple-versions-of-treatment" class="level2">
<h2 class="anchored" data-anchor-id="multiple-versions-of-treatment">Multiple Versions of Treatment</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-multiple-version-treatment" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-multiple-version-treatment-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;25: Multiple Versions of Treatment</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="does-the-multiple-versions-of-treatments-approach-save-us" class="level2">
<h2 class="anchored" data-anchor-id="does-the-multiple-versions-of-treatments-approach-save-us">Does the Multiple Versions of Treatments Approach Save Us?</h2>
<p>Measurement error remeains a problem if errors are either directed or dependent (correlated) or both. (See: measurement link.)</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-dep-udir-effect-confounders-3wave" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="common_graphs_files/figure-html/fig-dag-dep-udir-effect-confounders-3wave-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;26: Measurement error opens a pathway to confounding if either there are correlated errors, or a directed effect of the exposure on the errors of measured outcome.</figcaption>
</figure>
</div>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>