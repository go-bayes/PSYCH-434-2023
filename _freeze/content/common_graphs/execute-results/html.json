{
  "hash": "9a35212605b373c6923a8fb0e7477592",
  "result": {
    "markdown": "---\ntitle: \"Temporal Causal Diagrams: Unveiling Causal Order and Indexing Nodes by Time\"\nexecute:\n  warning: false\ncode_folding: true\necho: true\ndraft: false\nauthor:\n  - name: Joseph Bulbulia\norcid: 0000-0002-5861-2056\naffiliation: Victoria University of Wellington, New Zealand\nemail: joseph.bulbulia@vuw.ac.nz\ncorresponding: yes\ndate-format: short\nsanitize: true\nkeep-tex: false\neditor_options: \n  chunk_output_type: inline\n---\n\n\n\n\n\n## Common Causal Graphs\n\n\n\n\n\n\n## Graphs of Canonical confounders\n\n\n### Confounding by Common Cause. \n\nThe problem of confounding by common cause arises when there is an unmeasured or unaccounted-for variable, denoted as \"L,\" that influences both the treatment variable, denoted by $A,$ and the outcome variable, denoted as $Y.$ This confounder, $L$,  creates an association between $A$ and $Y$ that is not solely due to the direct causal effect of $A$ on $Y$. Instead, the observed association between $A$ and $Y$ may be partially or entirely driven by the presence of $L$, making it difficult to isolate and accurately estimate the true causal effect of $A$ on $Y$.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Counfounding by common cause.](common_graphs_files/figure-html/fig-dag-common-cause-1.png){#fig-dag-common-cause width=100%}\n:::\n:::\n\n\n\n\n### Solution: adjust for the pre-exposure confounder\n\nConfounding by common cause can be addressed by adjusting for it. If $L$ is measured before the treatment (or exposure) is assigned, we may adjust for this confounder to account for its influence. Typically we adjust through through statistical techniques such as stratification, regression, matching, or inverse probability of treatment weighting. Sucg adjustment helps to mitigate the bias caused by the confounder, allowing for a more accurate estimation of the true causal relationship.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Solution: adjust for pre-exposure confounder.](common_graphs_files/figure-html/fig-dag-common-cause-solution-1.png){#fig-dag-common-cause-solution width=100%}\n:::\n:::\n\n\n\n### Second problem: Collider Stratification: conditioning on a common effect.\n\nConditioning on a common effect refers to a situation where there is a variable, $L$, is affected by both the treatment $A$ and an outcome $Y$.  Conditioning on $L$ creates a spurious association between $A$ and $Y$, biasing the true causal relationship. This occurs because the relationship between $A$ and $Y$ becomes confounded by the common effect $L$. The observed association  between $A$ and $Y$ may be solely driven by the influence of $L$.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Solution: ensure confounder is measured prior to the exposure.](common_graphs_files/figure-html/fig-dag-common-effect-1.png){#fig-dag-common-effect width=100%}\n:::\n:::\n\n\n\n\n### Solution: ensure all confounders are measured before the exposure\n\n\nTo address the problem of conditioning on a common effect, it is crucial to ensure that every potential confounder $L$ that may affect $A$ is measured before $A$. If such temporal order is preserved,  $L$ cannot be an effect of $A$, and thus neither of $Y$.  By measuring all relevant confounders in advance, researchers can minimize bias and obtain more reliable estimates of the true causal relationship between A and Y. Note that collider stratification may arise even if $L$ occurs before $A$, when $L$ does not affect $A$ or $Y$. This is called M-bias. We describe this case below. Note, however, that if $L$ is not a common cause of $A$ and $Y$, $L$ should not be included in our model because it is not a source of confounding.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph reveals bias: solve by stratification](common_graphs_files/figure-html/fig-dag-common-effect-solution-1.png){#fig-dag-common-effect-solution width=100%}\n:::\n:::\n\n\n\n\n### Third problem: conditioning on a mediator \n\nConditioning on a mediator refers to a situation where $L$ lies on the causal pathway between the treatment $A$ and the outcome $Y$.  Conditioning on $L$ can lead to biased estimates by blocking or distort the true causal pathway between $A$ and $Y$, obscuring the total effect of $A$ on $Y$.  Where $L$ is a collider between $A$ and an unmeasured confouder $U$, then including $L$ may increase the strength of association between $A$ and $Y$. We review this second possibility next. In either case, unless one is interested in mediation analysis (see below), conditioning on a post-treatment variable is always a bad idea. \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Third problem: conditioning on a mediator.](common_graphs_files/figure-html/fig-dag-mediator-1.png){#fig-dag-mediator width=100%}\n:::\n:::\n\n\n\n\n### Solution: ensure confounders are measured before the exposure.\n\nTo address the problem of mediator bias, do not condition on a mediator. Ensure that $L$ occurs before $A$ (and $Y$). Again we discover the importance of an explicit temporal ordering for our variables.  \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Do not condition on a mediator](common_graphs_files/figure-html/fig-dag-mediator-solution-1.png){#fig-dag-mediator-solution width=100%}\n:::\n:::\n\n\n\n### Fourth problem: conditioning on a descendant\n\n\nSay $X$ is a cause of $X*$. There is a theorem that proves that when we condition on $X*$ we partially condition on $X$. There are both negative and positive implications for causal estimation. First the negative. Suppose there is a confounder $L$ that is caused by an unobserved variable $U$, and is affected by the treatment $A$. Suppose further that $U$  causes the outcome $Y$. In this scenario, as described in @fig-dag-descendent, conditioning on $L$, which is a descendant of $A$ and $U$, can lead to a spurious association between $A$ and $Y$ through the path $A \\to L \\to U \\to Y$. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Conditioning on a descendant](common_graphs_files/figure-html/fig-dag-descendent-1.png){#fig-dag-descendent width=100%}\n:::\n:::\n\n\n\n### Solution: (yet again!) ensure that counfounders are measured before the exposure\n\n\nEnsuring the confounder (L) is measured before the exposure (A) has two beneficial properties. Firstly, if $L$ is a confounder, that is, if $L$ is a variable which if we fail to condition on it will bias the association between treatment and outcome, the strategy of including only pre-treatment indicators of $L$ will eliminate collider bias. Secondly, there is the positive side to the theorem that conditioning on a descendent is equivalent to partially conditioning on its parent: if an unmeasured confounder is associated with both $A$, $Y$, and $L$, then adjusting for $L$ helps to reduce confounding caused by the unmeasured confounder. By obtaining measure of $L$ that occur before $A$, such advantages can be achieved, allowing for more accurate estimation for the causal effect of $A$ on $Y$. We use the convention of a blue dotted arrow to indicate that the association between $A$ and $Y$ may still be biased, but that bias is reduced by inluding $L$\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Solution: conditioning on a descendent is part of the solution, not the problem, when baseline confounders are measured before the exposure.](common_graphs_files/figure-html/fig-dag-descendent-solution-1.png){#fig-dag-descendent-solution width=100%}\n:::\n:::\n\n\n### This ends the examples of cannoical casual diagrammes  \n\n\n\n## Examples \n\nNext some worked examples.\n\n## Common cause of exposure and outcome. \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Common cause of exposure and outcome: example](common_graphs_files/figure-html/fig-dag-1-1.png){#fig-dag-1 width=100%}\n:::\n:::\n\n\n### Solution: Adjust for Confounder\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Solution to this problem.](common_graphs_files/figure-html/fig-dag-2-1.png){#fig-dag-2 width=100%}\n:::\n:::\n\n\n\n\n### Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph reveals bias from pre-exosure indicator](common_graphs_files/figure-html/fig-dag-3-1.png){#fig-dag-3 width=100%}\n:::\n:::\n\n\n\n\n\n### Solution: adjust for confounder at baseline\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Solution to this problem](common_graphs_files/figure-html/fig-dag-4-1.png){#fig-dag-4 width=100%}\n:::\n:::\n\n\n\n\n\n###  A more thorough confounding control\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph:more general panel design](common_graphs_files/figure-html/fig-dag-5-1.png){#fig-dag-5 width=100%}\n:::\n:::\n\n\n\n###  Generic 3-wave panel design (VanderWeeele 2020)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph: three-wave panel design](common_graphs_files/figure-html/fig-dag-6-1.png){#fig-dag-6 width=100%}\n:::\n:::\n\n\n\n\n<!-- ### Selection bias version 1 -->\n\n\n\n\n<!-- ```{tikz} -->\n<!-- #| label: fig-dag-7 -->\n<!-- #| fig-cap: \"Causal graph: three-wave panel design with selection bias\" -->\n<!-- #| out-width: 100% -->\n<!-- #| echo: false -->\n\n<!-- \\usetikzlibrary{positioning} -->\n<!-- \\usetikzlibrary{shapes.geometric} -->\n<!-- \\usetikzlibrary{arrows} -->\n<!-- \\usetikzlibrary{decorations} -->\n<!-- \\tikzstyle{Arrow} = [->, thin, preaction = {decorate}] -->\n<!-- \\tikzset{>=latex} -->\n\n<!-- \\begin{tikzpicture}[{every node/.append style}=draw] -->\n\n<!-- \\node [rectangle, draw=white] (U) at (0, 0) {U}; -->\n<!-- \\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\\\t0/A \\\\t0/Y}; -->\n<!-- \\node [rectangle, draw=white] (A) at (4, 0) {t1/A}; -->\n<!-- \\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y}; -->\n<!-- \\node [rectangle, draw=black] (S) at (8, 0) {S}; -->\n\n<!-- \\draw [-latex, draw=black] (U) to (L); -->\n<!-- \\draw [-latex, draw=black] (L) to (A); -->\n<!-- \\draw [-latex, bend left=50, draw=black] (L) to (Y); -->\n<!-- \\draw [-latex, bend right=50, draw=black, dotted] (U) to (Y); -->\n<!-- \\draw [-latex, bend left=50, draw=black, dotted] (U) to (A); -->\n<!-- \\draw [-latex, draw=black] (Y) to (S); -->\n<!-- \\draw [-latex, bend right, draw=black] (A) to (S); -->\n<!-- \\draw [-latex, draw=red, dashed] (A) to (Y); -->\n\n\n<!-- \\end{tikzpicture} -->\n\n\n<!-- ``` -->\n\n\n### Selection bias: there are several types\n\n\n\n#### Unmeasured confounder affects selection and the outcome \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph: three-wave panel design with selection bias](common_graphs_files/figure-html/fig-dag-8-1.png){#fig-dag-8 width=100%}\n:::\n:::\n\n\n\n\n\n#### Unmeasured confounder affects a measured confounder of selection and the outcome, and there are unmeasured confourders that affect the measured confounder\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph: three-wave panel design with selection bias: example 2](common_graphs_files/figure-html/fig-dag-8-2-1.png){#fig-dag-8-2 width=100%}\n:::\n:::\n\n\n\n\n\n#### Unmeasured confounder affects slection into the study and also attrition\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph: three-wave panel design with selection bias: selection into the study (D) affects attrition](common_graphs_files/figure-html/fig-dag-8-4-1.png){#fig-dag-8-4 width=100%}\n:::\n:::\n\n\n\n\n\n#### Outcome and exposure affect attrition\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Causal graph:outcome and exposure affect attrition (Y measured with directed measurement error)](common_graphs_files/figure-html/fig-dag-8-5-1.png){#fig-dag-8-5 width=100%}\n:::\n:::\n\n\n\n#### Outcome and exposure affect attrition: we may approach this problem as one of directed measurement error.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![TBA](common_graphs_files/figure-html/fig-directed-measurement-error-1.png){#fig-directed-measurement-error width=100%}\n:::\n:::\n\n\n\n\n\n\n\n## Important Causal Diagrammes\n\n\n## How do we draw interactions? \n\n\n\n## Common cause of exposure and outcome. \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![A simple graph for effect-modification.](common_graphs_files/figure-html/fig-dag-effect-modfication-1.png){#fig-dag-effect-modfication width=100%}\n:::\n:::\n\n\n\n### Another graph for interaction \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![A simple graph for effect-modification.](common_graphs_files/figure-html/fig-dag-effect-modfication-2-1.png){#fig-dag-effect-modfication-2 width=100%}\n:::\n:::\n\n\n\n\n### M-Bias\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![M-bias: confounding control by including previous measures of the outcome](common_graphs_files/figure-html/fig-m-bias-1.png){#fig-m-bias width=100%}\n:::\n:::\n\n\n\n\n\n\n\n### What if mediation is of interest? \n\n\nConsider the assumptions required for mediation analysis:\n\n1. No unmeasured exposure-outcome confounders given  $L$ \n\n$$Y^{am}\\coprod A|L$$\n2. No unmeasured meadiator-outcome confounders given $L$ \n\n$$Y^{am}\\coprod M|L$$\n\n3. No unmeasured exposure-mediator confounders given $L$ \n\n$$M^{a}\\coprod A|L$$\n\n4. No mediator-outcome confounder affected by the exposure (no red arrow)\n\n$$Y^{am}\\coprod M^{a*}|L$$\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Assumptions for mediation analysis](common_graphs_files/figure-html/fig-dag-mediation-assuptions-1.png){#fig-dag-mediation-assuptions width=100%}\n:::\n:::\n\n\n\n\n\n### Confounder-Treatment Feedback\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Confounder Treatement Feedback](common_graphs_files/figure-html/fig-dag-9-1.png){#fig-dag-9 width=100%}\n:::\n:::\n\n\n\n\n## Multiple Versions of Treatment\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Multiple Versions of Treatment](common_graphs_files/figure-html/fig-dag-multiple-version-treatment-1.png){#fig-dag-multiple-version-treatment width=100%}\n:::\n:::\n\n\n\n\n\n## Does the Multiple Versions of Treatments Approach Save Us? \n\n\nMeasurement error remeains a problem if errors are either directed or dependent (correlated) or both. (See: measurement link.)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Measurement error opens a pathway to confounding if either there are correlated errors, or a directed effect of the exposure on the errors of measured outcome.](common_graphs_files/figure-html/fig-dag-dep-udir-effect-confounders-3wave-1.png){#fig-dag-dep-udir-effect-confounders-3wave width=100%}\n:::\n:::\n",
    "supporting": [
      "common_graphs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}