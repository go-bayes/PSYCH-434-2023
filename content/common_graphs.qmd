---
title: "Causal Graphs: A Practical Guide"
execute:
  warning: false
code_folding: true
echo: true
draft: false
author:
  - name: Joseph Bulbulia
orcid: 0000-0002-5861-2056
affiliation: Victoria University of Wellington, New Zealand
email: joseph.bulbulia@vuw.ac.nz
corresponding: yes
date-format: short
sanitize: true
keep-tex: false
editor_options: 
  chunk_output_type: inline
---




## Common Causal Graphs

```{r}
#| include: false
#| echo: false
#read libraries

library("tinytex")
library(extrafont)
loadfonts(device = "all")

# read libraries
source("/Users/joseph/GIT/templates/functions/libs2.R")

# read functions
#source("/Users/joseph/GIT/templates/functions/funs.R")
```


## Graphs of Canonical confounders


### First Problem: there is a common cause of an exposure and outcome



```{tikz}
#| label: fig-dag-common-cause
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (L) at (0, 0) {t0/L};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}
```



### Solution: adjust for the pre-exposure confounder


```{tikz}
#| label: fig-dag-common-cause-solution
#| fig-cap: "Causal graph reveals bias: solve by stratification"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```


### Second problem: conditioning on a common effect 



```{tikz}
#| label: fig-dag-common-effect
#| fig-cap: "Causal graph reveals bias: solve by stratification"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (A) at (0, 0) {t0/A};
\node [ellipse, draw=white] (Y) at (4, 0) {t1/Y};
\node [rectangle, draw=black] (L) at (8, 0) {t1*/L};
\draw [-latex, draw=black, bend right] (A) to (L);
\draw [-latex, draw=black] (Y) to (L);
\draw [-latex, draw=red, dashed] (A) to (Y);

\end{tikzpicture}

```



### Solution: ensure confounders are measured before the exposure


```{tikz}
#| label: fig-dag-common-effect-solution
#| fig-cap: "Causal graph reveals bias: solve by stratification"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}



```



### Third problem: conditioning on a mediator 



```{tikz}
#| label: fig-dag-mediator
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (A) at (0, 0) {t0/A};
\node [rectangle, draw=black] (L) at (4, 0) {t1/L};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, bend left, draw=black, dotted] (A) to (Y);
\draw [-latex, draw =black] (L) to (Y);
\draw [-latex, black] (A) to (L);
\end{tikzpicture}
```



### Solution: ensure confounders are measured before the exposure.



```{tikz}
#| label: fig-dag-mediator-solution
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}


```


### Fourth problem: conditioning on a descendant


```{tikz}
#| label: fig-dag-descendent
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [ellipse, draw=white] (A) at (2, 0) {t0/A};
\node [rectangle, draw=black](L) at (4, 0) {t1/L};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};

\draw [-latex, bend right=50] (U) to (L);
\draw [-latex, bend left, draw=black] (U) to (Y);
\draw [-latex,draw=black] (A) to (L);
\draw [-latex, bend left, draw=red, dashed] (A) to (Y);

\end{tikzpicture}

```


### Solution: ensure that counfounders are measured before the exposure

Note that that ensuring the confounder is measured before the exposure has a benefiting property. If the unmeasured confounder is associated with both A and Y, as well as with L, adjusting for L will diminish confounding arising from the unmeasured confounder. 

```{tikz}
#| label: fig-dag-descendent-solution
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]


\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black] (L) at (2, 0) {t0/L};
\node [rectangle, draw=white](A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};

\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, draw=blue, dotted] (A) to (Y);
\draw [-latex, bend left=50, draw =black] (L) to (Y);
\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);

\end{tikzpicture}

```


### What if mediation is of interest? 


Consider the assumptions required for mediation analysis.


```{tikz}
#| label: fig-dag-mediation-assuptions
#| fig-cap: "Assumptions for mediation analysis"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]


\node [rectangle, draw=black] (L1) at (0, 1) {t0/L1};
\node [rectangle, draw=black] (L2) at (0, -1) {t0/L2};
\node [ellipse, draw=white] (A) at (3, 0) {t1/A};
\node [rectangle, draw=black](L3) at (6, -1) {t2/L3};
\node [rectangle, draw=white](M) at (9, 0) {t2*/M};
\node [rectangle, draw=white](Y) at (12, 0) {t3/Y};


\draw [-latex, draw=brown] (L1) to (A);
\draw [-latex, draw=brown, bend left] (L1) to (Y);
\draw [-latex, draw=green] (L2) to (A);
\draw [-latex, draw=green] (L2) to (M);
\draw [-latex, draw= gray, dashed] (A) to (M);
\draw [-latex, draw= gray, dashed, bend left] (A) to (Y);
\draw [-latex, draw=red] (A) to (L3);
\draw [-latex, draw=purple] (L3) to (M);
\draw [-latex, draw=purple] (L3) to (Y);
\draw [-latex, draw= gray, dashed] (M) to (Y);




\end{tikzpicture}

```


## EXAMPLES 


### Common cause of exposure and outcome. 


```{tikz}
#| label: fig-dag-1
#| fig-cap: "Causal graph reveals bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (L) at (0, 0) {t0/Male};
\node [rectangle, draw=white] (A) at (4, 0) {t1/DoctorVisit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}
```

### Solution: Adjust for Confounder

```{tikz}
#| label: fig-dag-2
#| fig-cap: "Causal graph reveals bias: solve by stratification"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/Male};
\node [ellipse, draw=white] (A) at (4, 0) {t1/DoctorVisit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```



### Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2


```{tikz}
#| label: fig-dag-3
#| fig-cap: "Causal graph reveals bias from pre-exosure indicator"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (L) at (0, 0) {t0/Doctor Visit};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```




### Solution: adjust for confounder at baseline



```{tikz}
#| label: fig-dag-4
#| fig-cap: "Causal graph reveals bias from pre-exosure indicator"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Heart Attack};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```




###  A more thorough confounding control

```{tikz}
#| label: fig-dag-5
#| fig-cap: "Causal graph:more general panel design"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Male \\t0/Heart Attack \\t0/Heart Attack};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}


```


###  Generic 3-wave panel design (VanderWeeele 2020)

```{tikz}
#| label: fig-dag-6
#| fig-cap: "Causal graph: three-wave panel design"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};
\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, draw=red, dotted] (A) to (Y);
\draw [-latex, bend left=50, draw =black] (L) to (Y);
\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);


\end{tikzpicture}
```



<!-- ### Selection bias version 1 -->




<!-- ```{tikz} -->
<!-- #| label: fig-dag-7 -->
<!-- #| fig-cap: "Causal graph: three-wave panel design with selection bias" -->
<!-- #| out-width: 100% -->
<!-- #| echo: false -->

<!-- \usetikzlibrary{positioning} -->
<!-- \usetikzlibrary{shapes.geometric} -->
<!-- \usetikzlibrary{arrows} -->
<!-- \usetikzlibrary{decorations} -->
<!-- \tikzstyle{Arrow} = [->, thin, preaction = {decorate}] -->
<!-- \tikzset{>=latex} -->

<!-- \begin{tikzpicture}[{every node/.append style}=draw] -->

<!-- \node [rectangle, draw=white] (U) at (0, 0) {U}; -->
<!-- \node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y}; -->
<!-- \node [rectangle, draw=white] (A) at (4, 0) {t1/A}; -->
<!-- \node [ellipse, draw=white] (Y) at (6, 0) {t2/Y}; -->
<!-- \node [rectangle, draw=black] (S) at (8, 0) {S}; -->

<!-- \draw [-latex, draw=black] (U) to (L); -->
<!-- \draw [-latex, draw=black] (L) to (A); -->
<!-- \draw [-latex, bend left=50, draw=black] (L) to (Y); -->
<!-- \draw [-latex, bend right=50, draw=black, dotted] (U) to (Y); -->
<!-- \draw [-latex, bend left=50, draw=black, dotted] (U) to (A); -->
<!-- \draw [-latex, draw=black] (Y) to (S); -->
<!-- \draw [-latex, bend right, draw=black] (A) to (S); -->
<!-- \draw [-latex, draw=red, dashed] (A) to (Y); -->


<!-- \end{tikzpicture} -->


<!-- ``` -->


### Selection bias




```{tikz}
#| label: fig-dag-8
#| fig-cap: "Causal graph: three-wave panel design with selection bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (US) at (4, -1) {U};
\node [rectangle, draw=black](S) at (6, 0) {S};
\node [ellipse, draw=white] (Y) at (8, 0) {t2/Y};

\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, bend left=50, draw=black] (L) to (Y);
\draw [-latex, bend right=50, draw=black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw=black, dotted] (U) to (A);
\draw [-latex, draw=black] (A) to (S);
\draw [-latex, draw=black] (US) to (S);
\draw [-latex, draw=black] (US) to (Y);
\draw [-latex, bend left = 40, draw=red, dashed] (A) to (Y);


\end{tikzpicture}


```





### Confounder-Treatment Feedback



```{tikz}
#| label: fig-dag-9
#| fig-cap: "Confounder Treatement Feedback"
#| out-width: 100%
#| echo: false


\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black] (L0) at (2, 0) {t0/L};
\node [rectangle, draw=white] (A1) at (4, 0) {t1/A};
\node [rectangle, draw=black] (Y2) at (6, 0) {t2/Y};
\node [rectangle, draw=black] (L2) at (8, 0) {t2/L};
\node [rectangle, draw=white] (A2) at (10, 0) {t3/A};
\node [rectangle, draw=black] (Y3) at (12, 0) {t4/Y};

\draw [-latex, draw=black] (U) to (L0);
\draw [-latex, draw=black] (L0) to (A1);
\draw [-latex, draw=black] (L2) to (A2);

\draw [-latex, bend right, draw=black] (U) to (Y2);
\draw [-latex, bend right, draw=black] (U) to (L2);
\draw [-latex, bend right, draw=black] (U) to (Y3);

\draw [-latex, bend right, draw=red, dashed] (A1) to (Y3);
\draw [-latex, bend left, draw=red] (A1) to (L2);


\end{tikzpicture}
```
