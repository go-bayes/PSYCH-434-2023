---
title: "Temporal Causal Diagrams: Unveiling Causal Order and Indexing Nodes by Time"
execute:
  warning: false
code_folding: true
echo: true
draft: false
author:
  - name: Joseph Bulbulia
orcid: 0000-0002-5861-2056
affiliation: Victoria University of Wellington, New Zealand
email: joseph.bulbulia@vuw.ac.nz
corresponding: yes
date-format: short
sanitize: true
keep-tex: false
editor_options: 
  chunk_output_type: inline
---




## Common Causal Graphs

```{r}
#| include: false
#| echo: false
#read libraries

library("tinytex")
library(extrafont)
loadfonts(device = "all")

# read libraries
source("/Users/joseph/GIT/templates/functions/libs2.R")

# read functions
#source("/Users/joseph/GIT/templates/functions/funs.R")
```


## Graphs of Canonical confounders


### Confounding by Common Cause. 

The problem of confounding by common cause arises when there is an unmeasured or unaccounted-for variable, denoted as "L," that influences both the treatment variable, denoted by $A,$ and the outcome variable, denoted as $Y.$ This confounder, $L$,  creates an association between $A$ and $Y$ that is not solely due to the direct causal effect of $A$ on $Y$. Instead, the observed association between $A$ and $Y$ may be partially or entirely driven by the presence of $L$, making it difficult to isolate and accurately estimate the true causal effect of $A$ on $Y$.

```{tikz}
#| label: fig-dag-common-cause
#| fig-cap: "Counfounding by common cause."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}
% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (L) at (0, 0) {t0/L};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}
```



### Solution: adjust for the pre-exposure confounder

Confounding by common cause can be addressed by adjusting for it. If $L$ is measured before the treatment (or exposure) is assigned, we may adjust for this confounder to account for its influence. Typically we adjust through through statistical techniques such as stratification, regression, matching, or inverse probability of treatment weighting. Sucg adjustment helps to mitigate the bias caused by the confounder, allowing for a more accurate estimation of the true causal relationship.

```{tikz}
#| label: fig-dag-common-cause-solution
#| fig-cap: "Solution: adjust for pre-exposure confounder."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```


### Second problem: Collider Stratification: conditioning on a common effect.

Conditioning on a common effect refers to a situation where there is a variable, $L$, is affected by both the treatment $A$ and an outcome $Y$.  Conditioning on $L$ creates a spurious association between $A$ and $Y$, biasing the true causal relationship. This occurs because the relationship between $A$ and $Y$ becomes confounded by the common effect $L$. The observed association  between $A$ and $Y$ may be solely driven by the influence of $L$.

```{tikz}
#| label: fig-dag-common-effect
#| fig-cap: "Solution: ensure confounder is measured prior to the exposure."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (A) at (0, 0) {t0/A};
\node [ellipse, draw=white] (Y) at (4, 0) {t1/Y};
\node [rectangle, draw=black] (L) at (8, 0) {t2/L};
\draw [-latex, draw=black, bend right] (A) to (L);
\draw [-latex, draw=black] (Y) to (L);
\draw [-latex, draw=red, dashed] (A) to (Y);

\end{tikzpicture}

```



### Solution: ensure all confounders are measured before the exposure


To address the problem of conditioning on a common effect, it is crucial to ensure that every potential confounder $L$ that may affect $A$ is measured before $A$. If such temporal order is preserved,  $L$ cannot be an effect of $A$, and thus neither of $Y$.  By measuring all relevant confounders in advance, researchers can minimize bias and obtain more reliable estimates of the true causal relationship between A and Y. Note that collider stratification may arise even if $L$ occurs before $A$, when $L$ does not affect $A$ or $Y$. This is called M-bias. We describe this case below. Note, however, that if $L$ is not a common cause of $A$ and $Y$, $L$ should not be included in our model because it is not a source of confounding.


```{tikz}
#| label: fig-dag-common-effect-solution
#| fig-cap: "Causal graph reveals bias: solve by stratification"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}
% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}



```



### Third problem: conditioning on a mediator 

Conditioning on a mediator refers to a situation where $L$ lies on the causal pathway between the treatment $A$ and the outcome $Y$.  Conditioning on $L$ can lead to biased estimates by blocking or distort the true causal pathway between $A$ and $Y$, obscuring the total effect of $A$ on $Y$.  Where $L$ is a collider between $A$ and an unmeasured confouder $U$, then including $L$ may increase the strength of association between $A$ and $Y$. We review this second possibility next. In either case, unless one is interested in mediation analysis (see below), conditioning on a post-treatment variable is always a bad idea. 


```{tikz}
#| label: fig-dag-mediator
#| fig-cap: "Third problem: conditioning on a mediator."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (A) at (0, 0) {t0/A};
\node [rectangle, draw=black] (L) at (4, 0) {t1/L};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, bend left, draw=black, dotted] (A) to (Y);
\draw [-latex, draw =black] (L) to (Y);
\draw [-latex, black] (A) to (L);
\end{tikzpicture}
```



### Solution: ensure confounders are measured before the exposure.

To address the problem of mediator bias, do not condition on a mediator. Ensure that $L$ occurs before $A$ (and $Y$). Again we discover the importance of an explicit temporal ordering for our variables.  

```{tikz}
#| label: fig-dag-mediator-solution
#| fig-cap: "Do not condition on a mediator"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/L};
\node [ellipse, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}


```


### Fourth problem: conditioning on a descendant


Say $X$ is a cause of $X*$. There is a theorem that proves that when we condition on $X*$ we partially condition on $X$. There are both negative and positive implications for causal estimation. First the negative. Suppose there is a confounder $L$ that is caused by an unobserved variable $U$, and is affected by the treatment $A$. Suppose further that $U$  causes the outcome $Y$. In this scenario, as described in @fig-dag-descendent, conditioning on $L$, which is a descendant of $A$ and $U$, can lead to a spurious association between $A$ and $Y$ through the path $A \to L \to U \to Y$. 

```{tikz}
#| label: fig-dag-descendent
#| fig-cap: "Conditioning on a descendant"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [ellipse, draw=white] (A) at (2, 0) {t0/A};
\node [rectangle, draw=black](L) at (4, 0) {t1/L};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};

\draw [-latex, bend right=50] (U) to (L);
\draw [-latex, bend left, draw=black] (U) to (Y);
\draw [-latex,draw=black] (A) to (L);
\draw [-latex, bend left, draw=red, dashed] (A) to (Y);

\end{tikzpicture}

```


### Solution: (yet again!) ensure that counfounders are measured before the exposure


Ensuring the confounder (L) is measured before the exposure (A) has two beneficial properties. Firstly, if $L$ is a confounder, that is, if $L$ is a variable which if we fail to condition on it will bias the association between treatment and outcome, the strategy of including only pre-treatment indicators of $L$ will eliminate collider bias. Secondly, there is the positive side to the theorem that conditioning on a descendent is equivalent to partially conditioning on its parent: if an unmeasured confounder is associated with both $A$, $Y$, and $L$, then adjusting for $L$ helps to reduce confounding caused by the unmeasured confounder. By obtaining measure of $L$ that occur before $A$, such advantages can be achieved, allowing for more accurate estimation for the causal effect of $A$ on $Y$. We use the convention of a blue dotted arrow to indicate that the association between $A$ and $Y$ may still be biased, but that bias is reduced by inluding $L$

```{tikz}
#| label: fig-dag-descendent-solution
#| fig-cap: "Solution: conditioning on a descendent is part of the solution, not the problem, when baseline confounders are measured before the exposure."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]


\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black] (L) at (2, 0) {t0/L};
\node [rectangle, draw=white](A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};

\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, draw=blue, dotted] (A) to (Y);
\draw [-latex, bend right=50, draw =black] (U) to (Y);
\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);

\end{tikzpicture}

```

### This ends the examples of cannoical casual diagrammes  



## Examples 

Next some worked examples.

## Common cause of exposure and outcome. 


```{tikz}
#| label: fig-dag-1
#| fig-cap: "Common cause of exposure and outcome: example"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (L) at (0, 0) {t0/Male};
\node [rectangle, draw=white] (A) at (4, 0) {t1/DoctorVisit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}
```

### Solution: Adjust for Confounder

```{tikz}
#| label: fig-dag-2
#| fig-cap: "Solution to this problem."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=black] (L) at (0, 0) {t0/Male};
\node [ellipse, draw=white] (A) at (4, 0) {t1/DoctorVisit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=white] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```



### Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2


```{tikz}
#| label: fig-dag-3
#| fig-cap: "Causal graph reveals bias from pre-exosure indicator"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (L) at (0, 0) {t0/Heart Attack};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```




### Solution: adjust for confounder at baseline



```{tikz}
#| label: fig-dag-4
#| fig-cap: "Solution to this problem"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Heart Attack};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}

```




###  A more thorough confounding control

```{tikz}
#| label: fig-dag-5
#| fig-cap: "Causal graph:more general panel design"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Male \\t0/Heart Attack \\t0/Heart Attack};
\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};
\draw [-latex, draw=red, dashed] (A) to (Y);
\draw [-latex, bend left, draw =black] (L) to (Y);
\draw [-latex, black] (L) to (A);
\end{tikzpicture}


```


###  Generic 3-wave panel design (VanderWeeele 2020)

```{tikz}
#| label: fig-dag-6
#| fig-cap: "Causal graph: three-wave panel design"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};
\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, draw=red, dotted] (A) to (Y);
\draw [-latex, bend left=50, draw =black] (L) to (Y);
\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);


\end{tikzpicture}
```



<!-- ### Selection bias version 1 -->




<!-- ```{tikz} -->
<!-- #| label: fig-dag-7 -->
<!-- #| fig-cap: "Causal graph: three-wave panel design with selection bias" -->
<!-- #| out-width: 100% -->
<!-- #| echo: false -->

<!-- \usetikzlibrary{positioning} -->
<!-- \usetikzlibrary{shapes.geometric} -->
<!-- \usetikzlibrary{arrows} -->
<!-- \usetikzlibrary{decorations} -->
<!-- \tikzstyle{Arrow} = [->, thin, preaction = {decorate}] -->
<!-- \tikzset{>=latex} -->

<!-- \begin{tikzpicture}[{every node/.append style}=draw] -->

<!-- \node [rectangle, draw=white] (U) at (0, 0) {U}; -->
<!-- \node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y}; -->
<!-- \node [rectangle, draw=white] (A) at (4, 0) {t1/A}; -->
<!-- \node [ellipse, draw=white] (Y) at (6, 0) {t2/Y}; -->
<!-- \node [rectangle, draw=black] (S) at (8, 0) {S}; -->

<!-- \draw [-latex, draw=black] (U) to (L); -->
<!-- \draw [-latex, draw=black] (L) to (A); -->
<!-- \draw [-latex, bend left=50, draw=black] (L) to (Y); -->
<!-- \draw [-latex, bend right=50, draw=black, dotted] (U) to (Y); -->
<!-- \draw [-latex, bend left=50, draw=black, dotted] (U) to (A); -->
<!-- \draw [-latex, draw=black] (Y) to (S); -->
<!-- \draw [-latex, bend right, draw=black] (A) to (S); -->
<!-- \draw [-latex, draw=red, dashed] (A) to (Y); -->


<!-- \end{tikzpicture} -->


<!-- ``` -->


### Selection bias: there are several types



#### Unmeasured confounder affects selection and the outcome 


```{tikz}
#| label: fig-dag-8
#| fig-cap: "Causal graph: three-wave panel design with selection bias"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}
% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (US) at (4, -2) {U};
\node [rectangle, draw=black](S) at (6, 0) {S};
\node [ellipse, draw=white] (Y) at (8, 0) {t2/Y};

\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, bend left=50, draw=black] (L) to (Y);
\draw [-latex, bend right=50, draw=black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw=black, dotted] (U) to (A);
\draw [-latex, draw=black] (A) to (S);
\draw [-latex, draw=black] (US) to (S);
\draw [-latex, draw=black] (US) to (Y);
\draw [-latex, bend left = 40, draw=red, dashed] (A) to (Y);

\draw [cor, draw=red, bend right=20, dashed] (A) to (US);


\end{tikzpicture}


```




#### Unmeasured confounder affects a measured confounder of selection and the outcome, and there are unmeasured confourders that affect the measured confounder


```{tikz}
#| label: fig-dag-8-2
#| fig-cap: "Causal graph: three-wave panel design with selection bias: example 2"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [ellipse, draw=white] (US) at (4, -2) {U};
\node [rectangle, draw=white](L2) at (6, 0) {t2/L};
\node [rectangle, draw=black](S) at (8, 0) {S};
\node [ellipse, draw=white] (Y) at (10, 0) {t2/Y};

\draw [-latex, draw=black] (U) to (L);
\draw [-latex, draw=black] (L) to (A);
\draw [-latex, bend left=50, draw=black] (L) to (Y);
\draw [-latex, bend right=50, draw=black, dotted] (U) to (Y);
\draw [-latex, bend left=50, draw=black, dotted] (U) to (A);
\draw [-latex, draw=black] (A) to (L2);
\draw [-latex, draw=black] (L2) to (S);
\draw [-latex, draw=black] (US) to (L2);
\draw [-latex, draw=black, bend right=40] (US) to (Y);
\draw [-latex, bend left = 40, draw=red, dashed] (A) to (Y);

\draw [cor, draw=red, bend right=20, dashed] (A) to (US);


\end{tikzpicture}


```




#### Unmeasured confounder affects slection into the study and also attrition


```{tikz}
#| label: fig-dag-8-4
#| fig-cap: "Causal graph: three-wave panel design with selection bias: selection into the study (D) affects attrition"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (D) at (0, 0) {D};
\node [rectangle, draw=white] (A) at (2, 0) {t1/A};
\node [ellipse, draw=white] (US) at (0, -2) {U};
\node [rectangle, draw=black](S) at (4, 0) {S};
\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};

\draw [-latex, bend left=80, draw=black] (D) to (Y);
\draw [-latex, draw = black] (D) to (A);
\draw [-latex, draw=black, bend left=60] (D) to (S);
\draw [-latex, draw=black] (US) to (S);
\draw [-latex, draw=black] (US) to (Y);
\draw [-latex, bend left=40, draw=red, dashed] (A) to (Y);

\draw [cor, draw=red, bend right=10, dashed] (D) to (US);


\end{tikzpicture}

```




#### Outcome and exposure affect attrition


```{tikz}
#| label: fig-dag-8-5
#| fig-cap: "Causal graph:outcome and exposure affect attrition (Y measured with directed measurement error)"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]

\begin{tikzpicture}[{every node/.append style}=draw]


\node [rectangle, draw=white] (A) at (0, 0) {t1/A};
\node [ellipse, draw=white] (Y) at (3, 0) {t2/Y};
\node [rectangle, draw=black] (S) at (6, 0) {S};

\draw [-latex, bend left=80, draw=black] (A) to (S);
\draw [-latex, draw=black] (Y) to (S);
\draw [-latex, draw=red, dashed] (A) to (Y);



\end{tikzpicture}

```


#### Outcome and exposure affect attrition: we may approach this problem as one of directed measurement error.


```{tikz}
#| label: fig-directed-measurement-error
#| fig-cap: "TBA"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]


\begin{tikzpicture}[{every node/.append style}=draw]

%\node [rectangle, draw=white] (ULAY) at (0, 4) {U$_{t0/LAY}$};
\node [rectangle, draw=white] (UA) at (4, 3) {U$_{t1/A}$};
\node [rectangle, draw=white] (UY) at (8, 3) {U$_{t2/Y}$};

%\node [rectangle, draw=black] (L0) at (0, 1) {LAY$^{t0}$};
\node [rectangle, draw=black] (A1) at (4, 1) {A$^{t1}$};
\node [rectangle, draw=black] (Y2) at (8, 1) {Y$^{t2}$};
%\node [rectangle, draw=white] (Leta0) at (0, 0) {L$^{t0}_\eta$};
\node [rectangle, draw=white] (Aeta1) at (4, 0) {A$^{t1}_\eta$};
\node [rectangle, draw=white] (Yeta2) at (8, 0) {Y$^{t2}_\eta$};


%\draw [-latex, draw=red] (ULAY) to (UA);
%\draw [-latex, draw=red] (ULAY) to (UY);

\draw [-latex, draw=black] (UA) to (A1);
\draw [-latex, draw=red] (UY) to (Y2);
%\draw [-latex, draw=black] (ULAY) to (L0);
%\draw [-latex, draw=black] (Leta0) to (L0);
%\draw [-latex, draw=black] (Leta0) to (Aeta1);
%\draw [-latex, draw=red, bend right=30] (Leta0) to (Yeta2);

\draw [-latex, draw=red] (Aeta1) to (A1);
\draw [-latex, draw=black] (Yeta2) to (Y2);

\draw [-latex, draw=red] (Aeta1) to (UY);
%\draw [-latex, draw=red] (Leta0) to (UA);



%\draw [cor, draw=red, dashed,bend right=80] (ULAY) to (Leta0);
%\draw [cor, draw=red, dashed, bend right = 80] (UA) to (Aeta1);
%\draw [cor, draw=red, dashed, bend left = 80] (UY) to (Yeta2);

\end{tikzpicture}
```






## Important Causal Diagrammes


## How do we draw interactions? 



## Common cause of exposure and outcome. 


```{tikz}
#| label: fig-dag-effect-modfication
#| fig-cap: "A simple graph for effect-modification."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [ellipse, draw=white] (G) at (0, 0) {t0/G};
\node [rectangle, draw=white] (A) at (4, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, draw=black] (A) to (Y);
\draw [-latex, bend left, draw =black] (G) to (Y);
\end{tikzpicture}
```


### Another graph for interaction 


```{tikz}
#| label: fig-dag-effect-modfication-2
#| fig-cap: "A simple graph for effect-modification."
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}


\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (A) at (0, 0) {t0/A};
\node [ellipse, draw=white] (G) at (4, 0) {t1/G};
\node [rectangle, draw=white] (Y) at (8, 0) {t2/Y};
\draw [-latex, bend left, draw=black] (A) to (Y);
\draw [-latex, draw =black] (G) to (Y);
\end{tikzpicture}
```



### M-Bias


```{tikz} 
#| label: fig-m-bias
#| fig-cap: "M-bias: confounding control by including previous measures of the outcome"
#| out-width: 100%
#| echo: false


\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzstyle{DoubleArrow} = [-, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (U1) at (0, 2) {U1};
\node [rectangle, draw=white] (U2) at (0, -2) {U2};
\node [rectangle, draw=black, align=left] (L) at (4, 0) {t0/L};
\node [rectangle, draw=white] (A) at (8, 0) {t1/A};
\node [rectangle, draw=white] (Y) at (12, 0) {t2/Y};

\draw [-latex, draw=black] (U1) to (L);
\draw [-latex, draw =black] (U2) to (L);
\draw [-latex, draw=black, bend left] (U1) to (Y);
\draw [-latex, draw =black, bend right] (U2) to (A);
\draw [-latex,  draw=red, red, dashed] (A) to (Y);


\end{tikzpicture}
```






### What if mediation is of interest? 


Consider the assumptions required for mediation analysis:

1. No unmeasured exposure-outcome confounders given  $L$ 

$$Y^{am}\coprod A|L$$
2. No unmeasured meadiator-outcome confounders given $L$ 

$$Y^{am}\coprod M|L$$

3. No unmeasured exposure-mediator confounders given $L$ 

$$M^{a}\coprod A|L$$

4. No mediator-outcome confounder affected by the exposure (no red arrow)

$$Y^{am}\coprod M^{a*}|L$$


```{tikz}
#| label: fig-dag-mediation-assuptions
#| fig-cap: "Assumptions for mediation analysis"
#| out-width: 100%
#| echo: false

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]


\node [rectangle, draw=black] (L1) at (0, 1) {t0/L1};
\node [rectangle, draw=black] (L3) at (0, -1) {t0/L3};
\node [ellipse, draw=white] (A) at (3, 0) {t1/A};
\node [rectangle, draw=black](L2) at (6, -1) {t2/L2};
\node [rectangle, draw=white](M) at (9, 0) {t2*/M};
\node [rectangle, draw=white](Y) at (12, 0) {t3/Y};


\draw [-latex, draw=brown] (L1) to (A);
\draw [-latex, draw=brown, bend left] (L1) to (Y);
\draw [-latex, draw=green] (L3) to (A);
\draw [-latex, draw=green] (L3) to (M);
\draw [-latex, draw= gray, dashed] (A) to (M);
\draw [-latex, draw= gray, dashed, bend left] (A) to (Y);
\draw [-latex, draw=red] (A) to (L2);
\draw [-latex, draw=blue] (L2) to (M);
\draw [-latex, draw=blue] (L2) to (Y);
\draw [-latex, draw= gray, dashed] (M) to (Y);





\end{tikzpicture}

```




### Confounder-Treatment Feedback



```{tikz}
#| label: fig-dag-9
#| fig-cap: "Confounder Treatement Feedback"
#| out-width: 100%
#| echo: false


\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

\begin{tikzpicture}[{every node/.append style}=draw]
\node [rectangle, draw=white] (U) at (0, 0) {U};
\node [rectangle, draw=black] (L0) at (2, 0) {t0/L};
\node [rectangle, draw=white] (A1) at (4, 0) {t1/A};
\node [rectangle, draw=black] (Y2) at (6, 0) {t2/Y};
\node [rectangle, draw=black] (L2) at (8, 0) {t2/L};
\node [rectangle, draw=white] (A2) at (10, 0) {t3/A};
\node [rectangle, draw=black] (Y3) at (12, 0) {t4/Y};

\draw [-latex, draw=black] (U) to (L0);
\draw [-latex, draw=black] (L0) to (A1);
\draw [-latex, draw=black] (L2) to (A2);

\draw [-latex, bend right, draw=black] (U) to (Y2);
\draw [-latex, bend right, draw=black] (U) to (L2);
\draw [-latex, bend right, draw=black] (U) to (Y3);

\draw [-latex, bend right, draw=red, dashed] (A1) to (Y3);
\draw [-latex, bend left, draw=red] (A1) to (L2);


\end{tikzpicture}
```



## Multiple Versions of Treatment

```{tikz}
#| label: fig-dag-multiple-version-treatment
#| fig-cap: "Multiple Versions of Treatment"
#| out-width: 100%
#| echo: false


\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}



\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=black] (L0) at (0, 0) {t0/L};
\node [rectangle, draw=white] (K1) at (4, 0) {t1/K};
\node [rectangle, draw=black] (A1) at (4, 2) {t1/A};
\node [rectangle, draw=white] (Y2) at (6, 0) {t2/Y};

\draw [-latex, draw=black] (L0) to (K1);
\draw [-latex, bend right, draw=black] (L0) to (Y2);
\draw [-latex, draw=black] (K1) to (A1);
\draw [-latex, draw=white, dashed] (K1) to (Y2);

\end{tikzpicture}
```




## Does the Multiple Versions of Treatments Approach Save Us? 


Measurement error remeains a problem if errors are either directed or dependent (correlated) or both. (See: measurement link.)

```{tikz}
#| label: fig-dag-dep-udir-effect-confounders-3wave
#| fig-cap: "Measurement error opens a pathway to confounding if either there are correlated errors, or a directed effect of the exposure on the errors of measured outcome."
#| out-width: 100%
#| echo: false
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations}
\tikzstyle{Arrow} = [->, thin, preaction = {decorate}]
\tikzset{>=latex}

% Define a simple decoration
\tikzstyle{cor} = [-, dotted, preaction = {decorate}]


\begin{tikzpicture}[{every node/.append style}=draw]

\node [rectangle, draw=white] (ULAY) at (0, 4) {U$_{t0/L}$};
\node [rectangle, draw=white] (UA) at (4, 3) {U$_{t1/A}$};
\node [rectangle, draw=white] (UY) at (8, 4) {U$_{t2/Y}$};

\node [rectangle, draw=black] (L0) at (0, 1) {L$^{t0}$};
\node [rectangle, draw=black] (A1) at (4, 1) {A$^{t1}$};
\node [rectangle, draw=black] (Y2) at (8, 1) {Y$^{t2}$};
\node [rectangle, draw=white] (Leta0) at (0, 0) {t1/L$_\eta$};
\node [rectangle, draw=white] (Aeta1) at (4, 0) {t1/A$_\eta$};
\node [rectangle, draw=white] (Yeta2) at (8, 0) {t2/Y$_\eta$};


\draw [-latex, draw=red] (ULAY) to (UA);
\draw [-latex, draw=red] (ULAY) to (UY);

\draw [-latex, draw=red] (UA) to (A1);
\draw [-latex, draw=red] (UY) to (Y2);
\draw [-latex, draw=red] (ULAY) to (L0);
\draw [-latex, draw=black] (Leta0) to (L0);
\draw [-latex, draw=red] (Leta0) to (Aeta1);
\draw [-latex, draw=red, bend right=30] (Leta0) to (Yeta2);

\draw [-latex, draw=black] (Aeta1) to (A1);
\draw [-latex, draw=black] (Yeta2) to (Y2);

\draw [-latex, draw=red] (Aeta1) to (UY);
%\draw [-latex, draw=black] (Leta0) to (UA);



\draw [cor, draw=red, dashed,bend right=80] (ULAY) to (Leta0);
\draw [cor, draw=red, dashed, bend right = 80] (UA) to (Aeta1);
%\draw [cor, draw=red, dashed, bend left = 80] (UY) to (Yeta2);

\end{tikzpicture}
```



## Add Graph on when we might want to condition on a post treatment indicator



